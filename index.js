class t{constructor(t,s,i,h){this.x=t,this.y=s,this.width=i,this.height=h}static t(s){return new t(s.x,s.y,s.width,s.height)}}function s(t,i,h=!1){let e=!1;const n=t.x,S=t.x+t.width,a=i.x,A=i.x+i.width;(S>a&&S<=A||n<A&&n>=a||n<=a&&S>=A)&&(e=!0);let E=!1;const c=t.y,r=t.y+t.height,o=i.y,C=i.y+i.height;(r>o&&r<=C||c<C&&c>=o||c<=o&&r>=C)&&(E=!0);const l=e&&E;return l||!h&&s(i,t,!0)}function i(t,s){return t.x===s.x&&t.y===s.y&&t.width===s.width&&t.height===s.height}function h(t,s){return t.x===s.x&&t.y===s.y}function e(){CANVAS_WIDTH=canvasContainer.clientWidth,CANVAS_HEIGHT=canvasContainer.clientHeight;const t=CANVAS_HEIGHT/240,s=CANVAS_WIDTH/450;SCALE=Math.floor(Math.min(s,t)),canvas.width=CANVAS_WIDTH,canvas.height=CANVAS_HEIGHT,window.onresize=n}function n(){promptedResize||(promptedResize=!0,alert("Please refresh the page to fit the new size"),window.location.reload())}function S(t,s){a(t,s),A(t,s)}function a(t,s){const i=t.frame.x+t.frame.width/2;t.frame.y,t.frame.height;CAM_X_OFFSET=-(i-CANVAS_WIDTH/2),CAM_X_OFFSET>0&&(CAM_X_OFFSET=0),CAM_X_OFFSET<-s.width+CANVAS_WIDTH&&(CAM_X_OFFSET=-s.width+CANVAS_WIDTH)}function A(t,s){t.frame.x,t.frame.width;const i=t.frame.y+t.frame.height/2;CAM_Y_OFFSET=-(i-CANVAS_HEIGHT/2),CAM_Y_OFFSET>0&&(CAM_Y_OFFSET=0),CAM_Y_OFFSET<-s.height+CANVAS_HEIGHT&&(CAM_Y_OFFSET=-s.height+CANVAS_HEIGHT)}function E(t){const s=[];let i=-Math.floor(CAM_X_OFFSET/(SCALE*GameObject_BASE_SIZE))-2,h=-Math.floor(CAM_Y_OFFSET/(SCALE*GameObject_BASE_SIZE))-2;i=i<0?0:i,h=h<0?0:h;let e=i+Math.floor(CANVAS_WIDTH/(SCALE*GameObject_BASE_SIZE))+4,n=h+Math.floor(CANVAS_HEIGHT/(SCALE*GameObject_BASE_SIZE))+4;e=e>=t.i.length?t.i.length-1:e,n=n>=t.i[0].length?t.i[0].length-1:n;for(const i of t.h)s.push(i);const S=s.length;let a=S;for(let A=i;A<=e;++A)for(let i=h;i<=n;++i){const h=t.i[A][i];h.S&&-1===t.o.indexOf(h)&&-1===t.A.indexOf(h)&&(h.C?s.push(h):(s.splice(S,0,h),++a))}for(let i of t.A)i.C?s.push(i):s.splice(a,0,i);for(let i of t.o)s.push(i);for(const s of t.Mi)s.l();for(let t of s)t.l()}SCALE=1,CANVAS_WIDTH=960,CANVAS_HEIGHT=640,CAM_X_OFFSET=0,CAM_Y_OFFSET=0,promptedResize=!1;class c{constructor(){this.L=l._("keyLeft")?l._("keyLeft"):"KeyA",this.u=l._("keyRight")?l._("keyRight"):"KeyD",this.m=l._("keyUp")?l._("keyUp"):"Space",this.left=!1,this.right=!1,this.I=!1,this.p=!0,window.addEventListener("keydown",(t=>{switch(t.code){case this.L:this.left=!0;break;case this.u:this.right=!0;break;case this.m:this.I=!0}})),window.addEventListener("keyup",(t=>{switch(t.code){case this.L:this.left=!1;break;case this.u:this.right=!1;break;case this.m:this.I=!1}}))}}class o{static g(t,s=!1){let i="";return s||(t.includes("Area")?i=t[4]+"/":t.includes("Level")?i=t[5]+"/":t.includes("Hub")||"Tutorial"===t?i="hub/":t.includes("Minigame")?i="minigames/"+t[8]+"/":t.includes("BPhase")?i="boss/phases/":t.includes("Background")||(i="boss/")),this.M("./src/levels/"+i+t+".txt")}static M(t){let s="";var i=new XMLHttpRequest;return i.open("GET",t,!1),i.onreadystatechange=function(){4===i.readyState&&(200!==i.status&&0!=i.status||(s=i.responseText))},i.send(null),s}static B(t){const s=t.split("| ");for(let t=0;t<s.length;++t){s[t]=s[t].split(", ");for(let i=0;i<s[t].length;++i)s[t][i]=s[t][i].split("; ")}return s}static O(t){switch(t){case 1:return"SpikeUp";case 2:return"SpikeDown";case 3:return"SpikeLeft";case 4:return"SpikeRight"}return null}static G(t){switch(t){case 1:return"SpikeUpBG";case 2:return"SpikeDownBG";case 3:return"SpikeLeftBG";case 4:return"SpikeRightBG"}return null}static D(t){return"G"===t?1:"B"===t?2:"O"===t?3:"R"===t?4:"Pi"===t?5:"Pu"===t?6:1}static T(t){switch(t){case 1:return"GreenBlock";case 2:return"BlueBlock";case 3:return"OrangeBlock";case 4:return"RedBlock";case 5:return"PinkBlock";case 6:return"PurpleBlock";case 7:return"RedBlock"}return null}static k(t){switch(t){case 1:return"GreenBG";case 2:return"BlueBG";case 3:return"OrangeBG";case 4:return"RedBG";case 5:return"PinkBG";case 6:return"PurpleBG";case 7:return"RedBG"}return null}static F(t){switch(t){case 1:return"#00C800";case 2:return"blue";case 3:return"orange";case 4:return"red";case 5:return"#FF1493";case 6:return"#0000CD"}}static j(t){switch(t){case 1:return"ExitUp";case 2:return"ExitDown";case 3:return"ExitLeft";case 4:return"ExitRight"}return"ExitUp"}static H(t,s){return"Area1Entrance"===t?1:"Area2Entrance"===t?2:"Area3Entrance"===t?3:"Area4Entrance"===t?4:"Area5Entrance"===t?5:"Area6Entrance"===t?6:"FinalDungeon"===t?4:s}static v(t,s,i){let h=t.toString(16),e=s.toString(16),n=i.toString(16);return h=1===h.length?"0"+h:h,e=1===e.length?"0"+e:e,n=1===n.length?"0"+n:n,"#"+h+e+n}}class r{static Z(t){const s=[];for(const i of t)i.S&&(i.C?s.splice(0,0,i):s.push(i));return s}}class C{constructor(s,i){this.R=[],this.V=[],this.finished=null,this.N=!1,this.P=null,this.W=document.createElement("img"),this.W.setAttribute("src","./assets/blocks/"+s+".png");const h=GameObject_BASE_SIZE*SCALE,e=i.x%h,n=i.y%h;this.V.push(new t(i.x,i.y,h,h));for(let s=-1;s<CANVAS_WIDTH/h+1;++s)for(let i=-1;i<CANVAS_HEIGHT/h+1;++i)this.R.push(new t(s*h+e,i*h+n,h,h));this.max=Math.ceil(this.R.length/70)}l(){this.X();for(const t of this.V)ctx.drawImage(this.W,t.x,t.y,t.width,t.height)}X(){for(let t=0;t<this.max;++t)if(this.R.length>0){let t=Math.floor(Math.random()*this.R.length);this.V.push(this.R[t]),this.R.splice(t,1)}else this.finished=!0}}class l{static Y(t,s){window.localStorage.setItem(s,t)}static U(t){const s=window.localStorage.getItem(t);return s?parseInt(s):0}static _(t){return window.localStorage.getItem(t)}static K(t){return"true"===window.localStorage.getItem(t)}static q(){let t=[l.U("DRD"),l.U("DRC")],s=[l.U("CRD"),l.U("CRC")];const i=0===t[0]&&0===t[1],h=l.U("deaths");let e=0;for(let t=1;t<=6;++t)for(let s=1;s<=10;++s)e+=l.U("C"+t+"-"+s);(i||h<t[0]||h===t[0]&&e>t[1])&&(t=[h,e]),(i||e>s[1]||e===s[1]&&h<s[0])&&(s=[h,e]),window.localStorage.clear(),l.Y(t[0],"DRD"),l.Y(t[1],"DRC"),l.Y(s[0],"CRD"),l.Y(s[1],"CRC")}}class L{constructor(t,s,i){this.text=t,this.font=s.split(" "),this.J(i)}$(){canvasContainer.appendChild(this.tt)}st(){this.tt.remove()}J(t){this.tt=document.createElement("p"),this.tt.innerText=this.text,this.tt.style.setProperty("font-size",this.font[0]),this.tt.style.setProperty("font-family",this.font[1]),this.tt.style.setProperty("color","white"),this.tt.style.setProperty("opacity",0),this.tt.style.setProperty("text-align","center"),this.tt.style.setProperty("position","absolute"),this.tt.style.setProperty("left",t.left+"px"),this.tt.style.setProperty("top",t.top+"px"),this.tt.style.setProperty("margin",0),this.tt.style.setProperty("pointer-events","none"),this.tt.style.setProperty("user-select","none"),this.tt.style.setProperty("-webkit-user-select","none"),this.tt.style.setProperty("-ms-user-select","none"),this.font[1].includes("Munro")&&!t.it?this.tt.style.setProperty("width",t.width+"px"):t.it&&this.tt.style.setProperty("display","inline-block")}ht(t){this.tt.style.setProperty("left",parseInt(this.tt.style.left.split("px")[0])+t+"px")}et(t){this.tt.style.setProperty("top",parseInt(this.tt.style.top.split("px")[0])+t+"px")}width(){return this.tt.clientWidth}height(){return this.tt.clientHeight}at(t){this.tt.style.setProperty("opacity",t)}nt(t){this.text=t,this.tt.innerText=this.text}ct(t){this.text+=t,this.tt.innerText=this.text}}SpeechBox_BUFFER=5;class _{constructor(s,i,h,e,n=!1){this.St=!0,this.ot=[],this.rt=0,this.index=0,this.done=!1,this.At=0,this.opacity=1,this.Et=0,this.Ct=null,this.font=h,this.text=i,this.frame=s,this.borderColor=e,this.lt=new L(this.text,this.font,{width:this.frame.width-SpeechBox_BUFFER*SCALE,left:this.frame.x+SpeechBox_BUFFER*SCALE,top:this.frame.y+.5*SpeechBox_BUFFER*SCALE}),this.lt.$(),this.frame.height=this.lt.height()+.5*SpeechBox_BUFFER*SCALE,n&&(this.frame.width=this.lt.width()+SpeechBox_BUFFER*SCALE),this.lt.nt("");for(let s=-1;s<=1;s+=2)this.ot.push(new t(this.frame.width*(1===s)-1*SCALE*(-1===s),0,1*SCALE,this.frame.height)),this.ot.push(new t(0,this.frame.height*(1===s)-1*SCALE*(-1===s),this.frame.width,1*SCALE))}Lt(){this.lt.st(),this.St=!1}_t(t){const s=t-this.frame.x;this.frame.x=t,this.lt.ht(s)}l(){if(!this.St)return;if(this.done||this.ut(),this.At>0&&(this.ft(),!this.St))return;const t=this.opacity>1?1:this.opacity;this.lt.at(t),ctx.globalAlpha=.7*t,ctx.fillStyle="black",ctx.fillRect(this.frame.x,this.frame.y,this.frame.width,this.frame.height),ctx.globalAlpha=t,ctx.fillStyle=this.borderColor;for(const t of this.ot)ctx.fillRect(this.frame.x+t.x,this.frame.y+t.y,t.width,t.height);ctx.globalAlpha=1}ut(){this.done||(++this.rt,5===this.rt&&(" "===this.text[this.index]&&this.text.length>this.index+1?(this.lt.ct(this.text[this.index]+this.text[this.index+1]),this.index+=2):this.lt.ct(this.text[this.index++]),this.index===this.text.length&&(this.done=!0),this.rt=0))}It(){this.done?this.Lt():(this.lt.nt(this.text),this.done=!0)}dt(){this.At=1}wt(){this.At=2}ft(){++this.Et%3==0&&(1===this.At?(this.opacity+=.1,this.opacity>=1&&(this.At=0,this.opacity=1)):(this.opacity-=.1,this.opacity<=0&&(this.At=0,this.opacity=0,this.Lt())))}}class f{static bt(s,i,h){let e=[],n=[];for(let t=-h;t<h;t+=.1*SCALE)n.push({x:s+t,y:i-Math.sqrt(Math.pow(h,2)-Math.pow(t,2))});for(let t=h;t>-h;t-=.1*SCALE)n.push({x:s+t,y:i+Math.sqrt(Math.pow(h,2)-Math.pow(t,2))});const S=new F(new t(n[0].x,n[0].y,.5*GameObject_BASE_SIZE*SCALE,.5*GameObject_BASE_SIZE*SCALE),100);S.gt={x:s,y:i},e.push(S),n.splice(0,1);let a=S;for(const h of n){const n=Math.sqrt(Math.pow(a.frame.x-h.x,2)+Math.pow(a.frame.y-h.y,2)),A=Math.sqrt(Math.pow(S.frame.x-h.x,2)+Math.pow(S.frame.y-h.y,2));if(e.length>GameObject_BASE_SIZE*SCALE&&A<.5*GameObject_BASE_SIZE*SCALE)return e;if(n>.8*GameObject_BASE_SIZE*SCALE&&n<1.05*GameObject_BASE_SIZE*SCALE){const n=new F(new t(h.x,h.y,.5*GameObject_BASE_SIZE*SCALE,.5*GameObject_BASE_SIZE*SCALE),100);S.gt={x:s,y:i},e.push(n),a=n}}return e}}GameObject_BASE_SIZE=20;class u{constructor(t,s){this.S=!0,this.size=SCALE*GameObject_BASE_SIZE,this.W=null,this.Mt=!1,this.Bt=!1,this.Ot=[],this.Gt=null,this.Dt=!1,this.xt=!1,this.Tt=!1,this.kt=0,this.Ft=0,this.jt=0,this.Ht=0,this.index=null,this.opacity=1,this.frame={x:t,y:s,width:this.size,height:this.size}}vt(t){this.W=document.createElement("img"),this.W.setAttribute("src","./assets/"+t)}l(){ctx.globalAlpha=this.opacity,ctx.drawImage(this.W,this.frame.x+CAM_X_OFFSET,this.frame.y+CAM_Y_OFFSET,this.frame.width,this.frame.height),ctx.globalAlpha=1}Zt(t,s){return!1}yt(t){t.Rt||this.Ot.push(t)}Vt(s){if(this.jt=0,this.Ht=0,this.frame=new t(this.frame.x+this.kt,this.frame.y+this.Ft,this.frame.width,this.frame.height),s.Nt===this?s.frame=new t(s.frame.x+this.kt,s.frame.y+this.Ft,s.frame.width,s.frame.height):s.Pt===this&&(s.frame=new t(s.frame.x+this.kt,s.frame.y,s.frame.width,s.frame.height)),s.Wt&&s.Xt&&(s.Xt.Nt==this?(s.Xt.frame.x+=this.kt,s.Xt.frame.y+=this.Ft):s.Xt.Pt==this&&(s.Xt.frame.x+=this.kt)),this.Gt&&this.Gt.active)if(this.Gt.Yt)this.jt=b.Ut(this),this.Ht=b.Kt(this),this.frame.x+=this.jt,this.frame.y+=this.Ht,s.qt===this&&(s.frame.x+=this.jt,s.frame.y+=this.Ht),s.Wt&&s.Xt&&s.Xt.qt==this&&(s.Xt.frame.x+=this.jt,s.Xt.frame.y+=this.Ht),i(this.frame,this.Gt.zt[0])&&this.Jt();else if(this.Gt.Qt)this.frame=t.t(this.Gt.zt[0]),this.Jt();else if(++this.Gt.$t,this.Gt.$t>=this.Gt.ts){let s=this.Gt.ss+1;s>this.Gt.total&&(s=1),this.Gt.ss=s,this.frame=t.t(this.Gt.zt[this.Gt.ss-1]),this.Gt.$t=0,this.hs()}}es(t){this.Gt&&(this.Gt.active=!1),t.active=!0,this.Gt=t}Jt(){this.Gt.active=!1,this.Dt=!0,this.hs()}hs(){this.Gt.ns.length>0&&(this.Gt.Yt||this.Gt.Qt?this.cs=this.Gt.ns[0]:this.cs=this.Gt.ns[this.Gt.ss-1],this.W.setAttribute("src","./assets/spikes/"+o.O(this.cs)+".png"))}Ss(t){let i=!1;for(const h of this.Ot)h.active||i||(s(h.os.frame,h.rs)||t.Xt&&h.os==t&&s(t.Xt.frame,h.rs))&&(this.es(h),i=!0,t.Nt===this&&this.C&&t.As(this))}Es(t){this.frame.x+=t;for(const s of this.Ot){s.rs.x+=t;for(let i=0;i<s.zt.length;i++)s.zt[i].x+=t}}}class m{constructor(t){this.speed=0,this.os=null,this.rs=null,this.zt=[],this.ns=[],this.Cs=null,this.active=!1,this.Rt=!1}static ls(t){let s;return"move"===t[0][0]?s=new I(t):"alternate"===t[0][0]?s=new w(t):"teleport"===t[0][0]?s=new p(t):(s=new m(null),s.Rt=!0),s}static Ls(t){return h(t,{x:-1,y:-1})?1:h(t,{x:-2,y:-2})?2:3}}class I extends m{constructor(t){if(super(t),this.Yt=!0,!t)return this;this.speed=parseFloat(t[1][0]),"player"===t[3][0]?this.Cs={x:-1,y:-1}:"boss"===t[3][0]?this.Cs={x:-2,y:-2}:this.Cs={x:parseInt(t[3][0]),y:parseInt(t[3][1])},this.rs={x:SCALE*parseInt(t[4][0]),y:SCALE*parseInt(t[4][1]),width:SCALE*parseInt(t[4][2]),height:SCALE*parseInt(t[4][3])},this.zt=[{x:SCALE*parseInt(t[2][0]),y:SCALE*parseInt(t[2][1]),width:SCALE*GameObject_BASE_SIZE,height:SCALE*GameObject_BASE_SIZE}],t[2].length>2&&(this.ns=[parseInt(t[2][2])])}static _s(t,s,i){const h=new I(null);return h.speed=t,h.Cs={x:-1,y:-1},h.rs={x:i.frame.x-SCALE*GameObject_BASE_SIZE,y:i.frame.y-SCALE*GameObject_BASE_SIZE,width:50*SCALE,height:50*SCALE},h.zt=[s],[h]}}class p extends m{constructor(t){super(t),this.Qt=!0,"player"===t[2][0]?this.Cs={x:-1,y:-1}:"boss"===t[2][0]?this.Cs={x:-2,y:-2}:this.Cs={x:parseInt(t[2][0]),y:parseInt(t[2][1])},this.rs={x:SCALE*parseInt(t[3][0]),y:SCALE*parseInt(t[3][1]),width:SCALE*parseInt(t[3][2]),height:SCALE*parseInt(t[3][3])},this.zt=[{x:SCALE*parseInt(t[1][0]),y:SCALE*parseInt(t[1][1]),width:SCALE*GameObject_BASE_SIZE,height:SCALE*GameObject_BASE_SIZE}],t[1].length>2&&(this.ns=[parseInt(t[1][2])])}}class w extends m{constructor(t){super(t),this.us=!0,this.$t=0,this.ts=0,this.ss=0,this.total=0;let s=t.length-5;this.total=1+s,"player"===t[3+s][0]?this.Cs={x:-1,y:-1}:"boss"===t[3+s][0]?this.Cs={x:-2,y:-2}:this.Cs={x:parseInt(t[3+s][0]),y:parseInt(t[3+s][1])},this.ss=1,this.ts=60*parseFloat(t[2+s][0]),this.rs={x:SCALE*parseInt(t[4+s][0]),y:SCALE*parseInt(t[4+s][1]),width:SCALE*parseInt(t[4+s][2]),height:SCALE*parseInt(t[4+s][3])};for(let s=1;s<this.total+1;s++)this.zt.push({x:SCALE*parseInt(t[s][0]),y:SCALE*parseInt(t[s][1]),width:SCALE*GameObject_BASE_SIZE,height:SCALE*GameObject_BASE_SIZE}),t[s].length>2&&this.ns.push(parseInt(t[s][2]))}}class b{static Ut(t){let s=t.Gt.zt[0].x-t.frame.x;const i=Math.abs(t.Gt.zt[0].y-t.frame.y),h=t.Gt.speed;let e=1;return s<0&&(s=Math.abs(s),e=-1),s<2*h*SCALE&&i<2*h*SCALE?s*e:s>i?h*e*SCALE:h*(s/i)*e*SCALE}static Kt(t){const s=Math.abs(t.Gt.zt[0].x-t.frame.x);let i=t.Gt.zt[0].y-t.frame.y;const h=t.Gt.speed;let e=1;return i<0&&(i=Math.abs(i),e=-1),i<2*h*SCALE&&s<2*h*SCALE?i*e:i>s?h*e*SCALE:h*(i/s)*e*SCALE}static fs(t,s,i){let h=s.x-t.x;const e=Math.abs(s.y-t.y);let n=1;return h<0&&(h=Math.abs(h),n=-1),h<2*i*SCALE&&e<2*i*SCALE?h*n:h>e?i*n*SCALE:i*(h/e)*n*SCALE}static Is(t,s,i){const h=Math.abs(s.x-t.x);let e=s.y-t.y,n=1;return e<0&&(e=Math.abs(e),n=-1),e<2*i*SCALE&&h<2*i*SCALE?e*n:e>h?i*n*SCALE:i*(e/h)*n*SCALE}}class d extends u{constructor(t,s,i){super(t,s),this.C=!0,this.ps=!0,this.ds=0,this.ws=0,"Su"===i?(this.ds=-1,this.vt("spikes/"+o.O(1)+".png")):(this.ds=o.D(i),this.vt("blocks/"+o.T(this.ds)+".png"))}Zt(h,e){let n=0;this.ws=0,h.bs&&(n=.3*-this.size);let S=e,a=0;(this.Gt&&this.Gt.active||this.Dt)&&0!=this.jt&&(a=10*SCALE,this.Dt=!1);let A=Math.round(this.frame.x)%h.gs==0?0:1;return h.Ms&&h.Bs||(s(h.frame,this.frame)?h.Pt!==this&&h.frame.y<this.frame.y+this.frame.height&&h.frame.y>this.frame.y+.5*this.frame.height-this.Ht&&h.frame.x<this.frame.x+.9*this.frame.width&&h.frame.x+h.frame.width>this.frame.x+.1*this.frame.width&&!(this.Gt&&this.Gt.active&&h.Pt&&i(h.Pt.frame,new t(this.frame.x,this.frame.y+this.frame.height,this.frame.width,this.frame.width)))?(this.ws=2,h.frame.y=this.frame.y+this.frame.height,h.Wt&&h.Os.I&&(h.Gs=!1),e||this.Ds(h.Wt),S=!0,h.xs()):h.frame.x+h.frame.width>=this.frame.x&&h.frame.x+h.frame.width<this.frame.x+.25*this.frame.width+a&&h.frame.y+h.frame.height+n>this.frame.y&&h.frame.y<this.frame.y+.9*this.frame.height?(this.ws=3,h.frame.x=this.frame.x-h.frame.width-A,this===h.Pt||h.Pt&&i(this.frame,h.Pt.frame)||!this.Ts(h)||(this.Ds(h.Wt),h.Pt=this)):h.frame.x<=this.frame.x+this.frame.width&&h.frame.x>this.frame.x+.75*this.frame.width-a&&h.frame.y+h.frame.height+n>this.frame.y&&h.frame.y<this.frame.y+.9*this.frame.height?(this.ws=4,h.frame.x=this.frame.x+this.frame.width+A,this===h.Pt||h.Pt&&i(this.frame,h.Pt.frame)||!this.Ts(h)||(this.Ds(h.Wt),h.Pt=this)):h.frame.y+h.frame.height>=this.frame.y&&h.frame.y<this.frame.y+.25*this.frame.height-this.Ht&&h.frame.x<this.frame.x+.85*this.frame.width&&h.frame.x+h.frame.width>this.frame.x+.15*this.frame.width&&!(this.Gt&&this.Gt.active&&h.Pt&&i(h.Pt.frame,new t(this.frame.x,this.frame.y-this.frame.height,this.frame.width,this.frame.width)))&&(this.ws=1,h.frame.y=this.frame.y-h.frame.height,e||(this===h.qt||h.qt&&i(this.frame,h.qt.frame)||this.Ds(h.Wt||h.ks),h.qt=this),S=!0,h.Nt=this,h.Ms?h.Fs=this.frame.y-75*SCALE:h.Wt&&h.As(this),h.Wt&&this.Gt&&this.Gt.active&&(h.Gs=!1),h.js=!1,h.bs=!1,h.Hs.y=0,h.vs=h.Zs):(!h.bs&&h.frame.y+h.frame.height===this.frame.y&&h.frame.y<this.frame.y+.25*this.frame.height&&h.frame.x<this.frame.x+this.frame.width&&h.frame.x+h.frame.width>this.frame.x&&(!h.Pt||h.frame.x<this.frame.x+this.frame.width-2*SCALE&&h.frame.x+h.frame.width>this.frame.x+2*SCALE)?(this.ws=1,e||(this===h.qt||h.qt&&i(this.frame,h.qt.frame)||this.Ds(h.Wt||h.ks),h.qt=this),S=!0,h.Wt&&h.As(this),h.vs=h.Zs,h.Nt=this,h.js=!1,h.bs=!1):(h.qt==this&&(h.qt=null),h.Nt==this&&(h.Nt=null)),h.frame.x+h.frame.width==this.frame.x&&h.frame.x+h.frame.width<this.frame.x+.25*this.frame.width&&h.frame.y+h.frame.height+n>this.frame.y&&h.frame.y<this.frame.y+this.frame.height?(this.ws=3,h.frame.x=this.frame.x-h.frame.width,this===h.Pt||h.Pt&&i(this.frame,h.Pt.frame)||!this.Ts(h)||(this.Ds(h.Wt),h.Pt=this)):h.frame.x==this.frame.x+this.frame.height&&h.frame.x>this.frame.x+.75*this.frame.width&&h.frame.y+h.frame.height+n>this.frame.y&&h.frame.y<this.frame.y+this.frame.height?(this.ws=4,h.frame.x=this.frame.x+this.frame.width,this===h.Pt||h.Pt&&i(this.frame,h.Pt.frame)||!this.Ts(h)||(this.Ds(h.Wt),h.Pt=this)):h.Pt===this&&(h.Pt=null))),S}Ds(t){if(t&&this.ps){let t=this.ds;for(;t===this.ds;)t=Math.floor(6*Math.random())+1;this.ys(t),this.ds=t}}ys(t){this.W.setAttribute("src","./assets/blocks/"+o.T(t)+".png")}Ts(t){return!(t.frame.x<=this.frame.x+this.frame.height&&t.frame.x>this.frame.x+.75*this.frame.width&&t.frame.y+t.frame.height>this.frame.y+this.frame.height&&t.frame.y<this.frame.y+2*this.frame.height||t.frame.x+t.frame.width>=this.frame.x&&t.frame.x+t.frame.width<this.frame.x+.25*this.frame.width&&t.frame.y+t.frame.height>this.frame.y+this.frame.height&&t.frame.y<this.frame.y+2*this.frame.height)}}class g extends u{constructor(t,s,i){super(t,s),this.Rs=!0,this.cs,this.cs=i,this.vt("spikes/"+o.O(i)+".png")}vt(t){super.vt(t)}Zt(t,i){if(!(t.Vs||t.Ms&&t.Bs)&&s(this.frame,t.frame))if(1===this.cs){for(let s=0;s<17;s+=2)if(t.frame.x<=this.frame.x+(18-s/2)*SCALE&&t.frame.x+t.frame.width>=this.frame.x+(1+s/2)*SCALE&&t.frame.y<=this.frame.y+(20-s)*SCALE&&t.frame.y+t.frame.height>=this.frame.y+(17-s)*SCALE)return!0}else if(2===this.cs){for(let s=17;s>1;s-=2)if(t.frame.x<=this.frame.x+(18-s/2)*SCALE&&t.frame.x+t.frame.width>=this.frame.x+(1+s/2)*SCALE&&t.frame.y<=this.frame.y+(3+s)*SCALE&&t.frame.y+t.frame.height>=this.frame.y)return!0}else if(3===this.cs){for(let s=0;s<19;s+=2)if(t.frame.x<=this.frame.x+this.frame.width-s*SCALE&&t.frame.x+t.frame.width>=this.frame.x+this.frame.width-s*SCALE&&t.frame.y+t.frame.height>=this.frame.y+s/2*SCALE&&t.frame.y<=this.frame.y+this.frame.width-s/2*SCALE)return!0}else if(4===this.cs)for(let s=0;s<19;s+=2)if(t.frame.x<=this.frame.x+s*SCALE&&t.frame.x+t.frame.width>=this.frame.x+s*SCALE&&t.frame.y+t.frame.height>=this.frame.y+s/2*SCALE&&t.frame.y<=this.frame.y+this.frame.height-s/2*SCALE)return!0;return!1}Ns(i){this.Gt&&this.Gt.active&&(!this.Gt||!this.Gt.us)||i.bs||i.js||s(new t(this.frame.x-.1*this.frame.width,this.frame.y,1.2*this.frame.width,this.frame.height),i.frame)&&i.qt&&(this.frame.x<i.frame.x&&1===i.Ps.direction?(i.Ws=!0,i.Xs()):this.frame.x+this.frame.width>i.frame.x&&-1===i.Ps.direction&&(i.Ys=!0,i.Xs()))}}class O extends u{constructor(t,s){super(t,s),this.Us=!0,this.Ks=0,this.qs=0,this.active=!1,this.zs=-1,this.Js=[],this.opacity=1,this.animation=0,this.Et=0,this.vt("img-other/checkpoint.png"),this.opacity=.3,this.Ks={x:this.frame.x+6*SCALE,y:this.frame.y+9*SCALE}}l(){0!==this.animation&&this.Et++%3==0&&this.At(),ctx.globalAlpha=this.opacity,super.l(),ctx.globalAlpha=1}Zt(i){if(s(new t(this.frame.x+2*SCALE,this.frame.y,16*SCALE,20*SCALE),i.frame)){if(this.Qs(),i.$s.length>0&&this.Js.length!==i.$s.length){this.Js=[];for(const t of i.$s)this.Js.push(t.identifier),l.Y(!0,"chai"+t.identifier)}return!0}return!1}ti(){this.active=!1,this.opacity=.3,this.animation=0}Qs(){this.active||(this.active=!0,this.opacity=1,this.animation=1,l.Y(this.zs,"checkpoint"))}dt(){this.animation=1}wt(){this.animation=2}At(){1===this.animation?this.opacity>=1?(this.animation=0,this.Et=0):this.opacity+=.1:this.opacity<=.11?(this.animation=0,this.Et=0):this.opacity-=.1}}class G{constructor(s,i,h,e,n,S){this.si=[],this.frame=s,this.P=e,this.ii=1===i||2===i?new t(n.x,0,n.width,1e4):new t(0,n.y,1e4,n.height),this.direction=i,this.hi=S,this.W=document.createElement("img"),this.W.setAttribute("src","./assets/img-other/exits/"+o.j(i)+".png"),this.ei=o.F(h);for(let s=2;s<18;++s){let h=null;switch(i){case 1:h=s<=9?new t(9*SCALE,(19-s)*SCALE,2*SCALE,1*SCALE):s<=12?new t(4*SCALE,(19-s)*SCALE,12*SCALE,1*SCALE):new t(4*SCALE+(s-12)*SCALE,(19-s)*SCALE,12*SCALE-2*(s-12)*SCALE,1*SCALE);break;case 2:h=s<=9?new t(9*SCALE,s*SCALE,2*SCALE,1*SCALE):s<=12?new t(4*SCALE,s*SCALE,12*SCALE,1*SCALE):new t(4*SCALE+(s-12)*SCALE,s*SCALE,12*SCALE-2*(s-12)*SCALE,1*SCALE);break;case 3:h=s<=9?new t((19-s)*SCALE,9*SCALE,1*SCALE,2*SCALE):s<=12?new t((19-s)*SCALE,4*SCALE,1*SCALE,12*SCALE):new t((19-s)*SCALE,4*SCALE+(s-12)*SCALE,1*SCALE,12*SCALE-2*(s-12)*SCALE);break;case 4:h=s<=9?new t(s*SCALE,9*SCALE,1*SCALE,2*SCALE):s<=12?new t(s*SCALE,4*SCALE,1*SCALE,12*SCALE):new t(s*SCALE,4*SCALE+(s-12)*SCALE,1*SCALE,12*SCALE-2*(s-12)*SCALE)}this.si.push({frame:h,opacity:0,ai:2===s})}}l(){this.animate(),ctx.drawImage(this.W,this.frame.x+CAM_X_OFFSET,this.frame.y+CAM_Y_OFFSET,this.frame.width,this.frame.height)}animate(){for(let t=2;t<18;++t){const s=this.si[t-2];s.ai?s.opacity+=.02:s.opacity>0&&(s.opacity-=.02);let i=1;this.si.length===t-1&&(i=t),s.opacity>.1&&!this.si[t-i].ai&&this.si[t-i].opacity<=0&&(this.si[t-i].ai=!0),s.opacity>=1&&(s.ai=!1),s.opacity>0&&(ctx.globalAlpha=s.opacity,ctx.fillStyle=this.ei,ctx.fillRect(this.frame.x+s.frame.x+CAM_X_OFFSET,this.frame.y+s.frame.y+CAM_Y_OFFSET,s.frame.width,s.frame.height))}ctx.globalAlpha=1}}class B extends u{constructor(s,i,h,e){super(s,i),this.si=[],this.ni=5,this.ci=!0,this.Et=0,this.Si=!1,this.oi=0,this.ri=null,this.finished=!1,this.Ai=h,this.Ei=e,this.Ci=i,this.dir=-1,this.W=document.createElement("img"),this.W.setAttribute("src","./assets/img-other/keys/ClearKey.png"),this.ei=o.F(h);for(let s=1;s<20;++s){let i=null;i=s<=7?new t(2*SCALE,s*SCALE,16*SCALE,1*SCALE):s<=11?new t(11*SCALE,s*SCALE,2*SCALE,1*SCALE):s<=18?new t(6*SCALE,s*SCALE,7*SCALE,1*SCALE):new t(10*SCALE,4*SCALE,1*SCALE,1*SCALE),this.si.push({frame:i,opacity:0,ai:1===s})}}l(){this.finished||(this.animate(),ctx.drawImage(this.W,this.frame.x+CAM_X_OFFSET,this.frame.y+CAM_Y_OFFSET,this.frame.width,this.frame.height))}animate(){if(this.ri&&0==--this.oi&&(this.ri.li.wt(),this.finished=!0),this.ci&&++this.Et%15==0&&(-1===this.dir&&this.frame.y-this.Ci>-this.ni*SCALE||1===this.dir&&this.frame.y!=this.Ci?this.frame.y+=this.dir*SCALE:this.dir=-this.dir),!this.Si){for(let t=0;t<19;t++){const s=this.si[t];s.ai?s.opacity+=.02:s.opacity>.1&&(s.opacity-=.02);let i=1;this.si.length===t+1&&(i=-t),s.opacity>.1&&!this.si[t+i].ai&&this.si[t+i].opacity<=.1&&(this.si[t+i].ai=!0),s.opacity>=1&&(s.ai=!1),s.opacity>0&&(ctx.globalAlpha=s.opacity,ctx.fillStyle=this.ei,ctx.fillRect(this.frame.x+s.frame.x+CAM_X_OFFSET,this.frame.y+s.frame.y+CAM_Y_OFFSET,s.frame.width,s.frame.height))}ctx.globalAlpha=1}}Li(s){this.Si=!0,this.W.setAttribute("src","./assets/img-other/keys/"+B._i(this.Ai)+".png"),this.ci=!0;const i="A"+this.Ai+"K";l.Y(!0,i+this.Ei),l.Y(l.U(i+"T")+1,i+"T");let h=0;for(let t=1;t<=5;t++)l.K(i+t)&&++h;const e="You found a key!\n"+h+"/5";return new _(new t(CANVAS_WIDTH/2-100*SCALE,15*SCALE,200*SCALE,100*SCALE),e,20*SCALE+"px Munro","#696969")}static _i(t){switch(t){case 1:return"GreenKey";case 2:return"BlueKey";case 3:return"OrangeKey";case 4:return"RedKey";case 5:return"PinkKey";case 6:return"PurpleKey"}}}class M extends d{constructor(s,i,h,e,n){if(super(s,i,h),this.ui=0,this.mi=0,this.Ai=0,this.fi=0,this.Ii=0,this.pi=0,this.di=null,this.wi=null,this.bi=null,this.gi=!1,this.opacity=1,this.Mi=n,n){switch(this.Ii=e,this.di=new F(new t(this.frame.x+this.frame.width/4,this.frame.y+this.frame.height/4,this.frame.width/2,this.frame.height/2),100),this.di.opacity=.7,this.pi=this.Ii>=10?this.frame.width/4:this.frame.width/2.5,this.Ii){case 8:case 9:this.pi-=1*SCALE;break;case 11:this.pi+=1*SCALE}this.Bi()}else this.fi=e,this.di=document.createElement("img"),this.di.setAttribute("src","./assets/img-other/keys/Keyhole.png")}l(){ctx.globalAlpha=this.opacity,super.l(),this.gi&&this.Oi(),this.di&&this.opacity>0&&(this.Mi?(this.di.l(),ctx.font=15*SCALE+"px MunroSmall",ctx.fillStyle="white",ctx.fillText(this.Ii,this.frame.x+this.pi+CAM_X_OFFSET,this.frame.y+this.frame.height/1.45+CAM_Y_OFFSET)):(ctx.drawImage(this.di,this.frame.x+CAM_X_OFFSET,this.frame.y+CAM_Y_OFFSET,this.frame.width,this.frame.height),this.wi&&ctx.drawImage(this.wi,this.bi.x+CAM_X_OFFSET,this.bi.y+CAM_Y_OFFSET,this.bi.width,this.bi.height))),ctx.globalAlpha=1}Zt(t,s){let i=s;return(this.opacity>0||!this.Mi)&&(i=super.Zt(t,s)),this.Bi(),i}Bi(){if(this.Mi){let t=0;for(let s=1;s<=62;s++)l.K("M"+s)&&t++;t>=this.Ii&&(this.opacity=0)}else if(0!==this.ws&&!this.wi){const s="A"+this.Ai+"KT";if(l.U(s)>0){switch(l.Y(l.U(s)-1,s),l.Y(!0,"A"+this.Ai+"L"+this.fi),this.ws){case 1:this.bi=new t(this.frame.x,this.frame.y-20*SCALE,20*SCALE,20*SCALE),this.mi=.5;break;case 2:this.bi=new t(this.frame.x,this.frame.y+20*SCALE,20*SCALE,20*SCALE),this.mi=-.5;break;case 3:this.bi=new t(this.frame.x-20*SCALE,this.frame.y,20*SCALE,20*SCALE),this.ui=.5;break;case 4:this.bi=new t(this.frame.x+20*SCALE,this.frame.y,20*SCALE,20*SCALE),this.ui=-.5}this.wi=document.createElement("img"),this.wi.setAttribute("src","./assets/img-other/keys/"+B._i(this.Ai)+".png"),this.gi=!0}}}Oi(){i(this.bi,this.frame)?(this.di=null,this.opacity-=.03,this.opacity<=0&&(this.gi=!1,this.frame=new t(-40,-40,20,20))):(this.bi.x+=this.ui*SCALE,this.bi.y+=this.mi*SCALE)}}class x{constructor(t){this.Ai=0,this.opacity=1,this.Gi="",this.Di=[],this.scale=t,this.blockSize=GameObject_BASE_SIZE*this.scale*SCALE,this.identity=t>.4?1:2}l(){const i=new t(-CAM_X_OFFSET*this.scale-1*GameObject_BASE_SIZE*SCALE,-CAM_Y_OFFSET*this.scale-1*GameObject_BASE_SIZE*SCALE,CANVAS_WIDTH+2*GameObject_BASE_SIZE*1*SCALE,CANVAS_HEIGHT+2*GameObject_BASE_SIZE*1*SCALE),h=this.Di.filter((t=>s(t.frame,i)));ctx.globalAlpha=this.opacity;for(const t of h)ctx.drawImage(t.xi,t.frame.x+CAM_X_OFFSET*this.scale,t.frame.y+CAM_Y_OFFSET*this.scale,t.frame.width,t.frame.height);ctx.globalAlpha=1}Ti(s,i,h,e=50){if(this.Ai=s,h!==this.Gi){this.Di=[],this.Gi=h;const n={width:CANVAS_WIDTH+(i.width-CANVAS_WIDTH)*this.scale,height:CANVAS_HEIGHT+(i.height-CANVAS_HEIGHT)*this.scale};if(!h.includes("#b1")&&!h.includes("#b2"))for(let i=0;i<n.width/this.blockSize/e;i++)for(let h=0;h<n.height/this.blockSize/e;h++){const n=Math.floor(5*Math.random()*SCALE),S=Math.floor(5*Math.random()*SCALE),a=o.g("backgrounds/Background"+Math.floor(40*Math.random())).split("\n");for(const A of a){const a=A.split(", ");let E;E="b"===a[0]?1===this.identity?"img-other/bg-layer1/"+o.k(s)+".png":"blocks/"+o.T(s)+".png":1===this.identity?"img-other/bg-layer1/"+o.G(parseInt(a[3]))+".png":"spikes/"+o.O(parseInt(a[3]))+".png";const c=document.createElement("img");c.setAttribute("src","./assets/"+E);const r=new t(.3*CANVAS_WIDTH+i*(this.blockSize*e)+parseInt(a[1])*this.scale*SCALE+n*this.blockSize,.4*CANVAS_HEIGHT+h*(this.blockSize*e)+parseInt(a[2])*this.scale*SCALE+S*this.blockSize,this.blockSize,this.blockSize);2===this.identity&&(this.opacity=this.scale-.4*this.scale),this.Di.push({xi:c,frame:r})}}}}reset(){}}class T{constructor(s){this.ki=[];const i=o.g(s);if(i.includes("#words")){const s=i.split("\n");let h="";for(const i of s){if("#words"===h&&"#"!==i[0]){const s=i.split("+ "),h=s[0].split("; "),e=(s[1].split("; "),.6*CANVAS_WIDTH),n=new _(new t(CANVAS_WIDTH/2-e/2,10*SCALE,e,0),s[2],20*SCALE+"px Munro","darkgray");n.It(),n.St=!1,n.Ct=new t(parseInt(h[0])*SCALE,parseInt(h[1])*SCALE,parseInt(h[2])*SCALE,parseInt(h[3])*SCALE),n.opacity=0,this.ki.push(n)}"#"===i[0]&&(h=i)}}}}Chai_DEFAULT_MOVE_SPEED=2,Chai_DEFAULT_MAX_JUMPS=1;class j{constructor(t,s){this.gs=SCALE*Chai_DEFAULT_MOVE_SPEED,this.Zs=Chai_DEFAULT_MAX_JUMPS,this.Fi=75*SCALE,this.Fs=0,this.Gs=!0,this.frame=null,this.size={height:11*SCALE,width:8*SCALE},this.Hs={x:0,y:0},this.ji=null,this.h=null,this.Pt=null,this.qt=null,this.Nt=null,this.Hi=null,this.vs=Chai_DEFAULT_MAX_JUMPS,this.vi=!1,this.js=!1,this.bs=!1,this.Zi=!1,this.yi=!1,this.Vs=!1,this.Ri=0,this.Vi=[],this.Ni=[],this.Pi=[],this.Wi=[],this.Xi=0,this.Yi=0,this.direction=1,this.Ui=!0,this.li=null,this.frame={x:t,y:s,width:this.size.width,height:this.size.height}}Ki(t){let s,i;0===t?(s="luke/LukeLeft",i="luke/LukeRight"):t<=6?(s="area"+t+"/Area"+t+"ChaiLeft",i="area"+t+"/Area"+t+"ChaiRight"):7===t?(s="mittens/MittensLeft",i="mittens/MittensRight"):console.log("No image provided (crash)");for(let t=0;t<2;++t)this.Vi[t]=document.createElement("img"),this.Vi[t].setAttribute("src","./assets/chais/"+s+(t+1)+".png"),this.Ni[t]=document.createElement("img"),this.Ni[t].setAttribute("src","./assets/chais/"+i+(t+1)+".png");for(let t=0;t<6;++t)this.Pi[t]=document.createElement("img"),this.Pi[t].setAttribute("src","./assets/chais/"+s+"Die"+(t+1)+".png"),this.Wi[t]=document.createElement("img"),this.Wi[t].setAttribute("src","./assets/chais/"+i+"Die"+(t+1)+".png")}l(){if(!this.yi||this.Xi<this.Yi){let t;if(this.qi){let s;s=this.Zi?1===this.direction?this.Wi:this.Pi:1===this.direction?this.Ni:this.Vi,t=s[Math.floor(this.Xi++/(this.Yi/s.length))%s.length]}else t=(1===this.direction?this.Ni:this.Vi)[0];ctx.drawImage(t,this.frame.x+CAM_X_OFFSET,this.frame.y+CAM_Y_OFFSET,this.frame.width,this.frame.height)}this.li&&this.li.l()}zi(){0===this.Ri?(this.bs&&this.Hs.y<5.83*SCALE&&(this.Hs.y+=.2*SCALE),this.frame.x+=this.Hs.x,this.frame.y+=this.Hs.y):this.Ri++,Math.floor(this.frame.x)%Math.floor(this.gs)==0||this.Nt&&this.Nt.Gt&&this.Nt.Gt.active&&(!this.Ms||Math.floor(this.Ps.frame.x)%Math.floor(this.gs)==Math.floor(this.frame.x)%Math.floor(this.gs))||(this.frame.x-=Math.floor(this.frame.x)%Math.floor(this.gs),this.Xs())}Ji(){this.bs&&this.Hs.y<5.83*SCALE&&(this.Hs.y+=.2*SCALE),this.frame.y+=this.Hs.y}left(){1===this.direction&&this.Qi(),this.qi&&-1===this.direction||this.$i(-1),this.Hs.x=-this.gs}right(){-1===this.direction&&this.Qi(),this.qi&&1===this.direction||this.$i(1),this.Hs.x=this.gs}Xs(){this.Hs.x=0,this.Qi()}th(){this.js=!0,this.Hs.y=-5.3*SCALE,this.bs=!1,this.vs=this.Zs}sh(){this.js=!0,this.Hs.y=-4.3*SCALE,this.bs=!1,this.vs--}xs(){this.bs||(this.Hs.y=.8*SCALE,this.bs=!0,this.vi=!1,this.Ms&&this.Ps&&this.ih+1<=this.Ps.$s.length&&(this.Ps.$s[this.ih].Fs=this.Fs))}hh(){this.Hi&&1===this.Hi.direction&&this.Vs?this.Hs.y=-3:this.js&&!this.bs?this.vs===this.Zs?this.frame.y>this.Fs?this.Hs.y<-3.83*SCALE&&(this.Hs.y+=.116*SCALE):this.vi=!0:this.frame.y>this.Fs?this.Hs.y<-3.6*SCALE&&(this.Hs.y+=.083*SCALE):(this.vi=!0,this.vs):!this.qt&&this.Ms&&this.xs()}eh(){if(!this.Vs){const i=[];if(s(new t(0,-10*SCALE,this.ji.width,10*SCALE),this.frame)?i.push(1):s(new t(0,this.ji.height-10*SCALE,this.ji.width,10*SCALE),this.frame)&&i.push(2),s(new t(-10*SCALE,0,10*SCALE,this.ji.height),this.frame)?i.push(3):s(new t(this.ji.width,0,10*SCALE,this.ji.height),this.frame)&&i.push(4),i.length>0){if(!this.Hi)for(const t of this.h)"decor"!==t.P&&(s(this.frame,t.ii)&&i.includes(t.direction)||i.includes(2)&&2===t.direction&&this.frame.x<=t.ii.x+t.ii.width&&this.frame.x>=t.ii.x)&&(this.Hi=t);for(const t of i)if(this.Hi)this.Vs=!0,this.Hi.direction>=3?(this.bs=!1,this.Hs.y=0):setTimeout((()=>this.Xs()),150);else switch(t){case 1:this.frame.y=0,this.Hs.y=.8,this.bs=!0,this.Wt&&this.Os.I&&(this.Gs=!1);break;case 2:break;case 3:this.frame.x=0;break;case 4:this.frame.x=this.ji.width-this.frame.width}}}}ah(){if(this.Zi=!0,this.yi=!0,this.Wt)for(const t of this.$s)t.Qi();else{this.Ps.Qi();for(const t of this.Ps.$s)t.Qi()}this.$i(this.direction)}$i(t){this.qi=!0,this.Yi=this.Zi?Math.ceil(30):Math.ceil(.18*60),this.Xi=this.Zi?0:this.Yi/2,this.direction=t}Qi(){this.qi=!1}nh(){let t=this.frame.x/(SCALE*GameObject_BASE_SIZE)-2;return t<0&&(t=0),Math.floor(t)}Sh(){let t=this.frame.y/(SCALE*GameObject_BASE_SIZE)-2;return t<0&&(t=0),Math.floor(t)}}class H extends j{constructor(t,s,i){super(t,s),this.Wt=!0,this.Os=null,this.oh=!1,this.$s=[],this.rh=!1,this.Xt=null,this.Ah=null,this.Ki(0),this.Os=i}l(){super.l(),this.Fi===50*SCALE&&this.Eh&&this.Eh.l(this.frame)}Ch(){this.hh(),this.Xt&&this.Xt.hh(),this.vi&&this.xs(),this.Xt&&this.Xt.vi&&this.Xt.xs(),this.rh=!1,0===this.Ri&&!this.Vs&&this.Os.p&&(this.Os.left&&(this.Hs.x===this.gs&&(this.Pt=null,this.Xt&&(this.Xt.Pt=null)),this.Hs.x!==-this.gs&&(this.left(),this.Xt&&this.Xt.right(),this.qt||this.lh(1,0))),this.Os.right&&(this.Hs.x===-this.gs&&(this.Pt=null,this.Xt&&(this.Xt.Pt=null)),this.Hs.x!==this.gs&&(this.right(),this.Xt&&this.Xt.left(),this.qt||this.lh(2,0))),this.Os.left===this.Os.right&&0!==this.Hs.x&&(this.Xs(),this.Xt&&this.Xt.Xs(),this.qt||this.lh(7,0)),this.rh=!0,this.Os.I&&this.Gs?(this.js||this.bs?this.vs>0&&this.oh&&(this.oh=!1,this.sh(),this.Fs=this.frame.y-38*SCALE,this.lh(5,1),this.js&&this.$s.length>0&&(this.$s[0].Fs=0)):(this.oh=!1,this.th(),this.Fs=this.frame.y-this.Fi,this.lh(4,1),this.js&&this.$s.length>0&&(this.$s[0].Fs=0)),this.Xt&&(this.Xt.js||this.Xt.bs?this.Xt.vs>0&&this.Xt.oh&&(this.Xt.oh=!1,this.Xt.sh(),this.Xt.Fs=this.Xt.frame.y-38*SCALE):(this.Xt.oh=!1,this.Xt.th(),this.Xt.Fs=this.Xt.frame.y-this.Fi*SCALE))):(this.oh=!0,this.Os.I||(this.Gs=!0),this.qt||this.xs(),this.Xt&&(this.Xt.oh=!0,this.Xt.qt||this.Xt.xs()))),this.Ri<0?(this.Ri++,this.Ji(),this.qi&&this.Qi(),0===this.Ri&&0!==this.Hs.x&&this.$i(this.direction)):(this.zi(),this.Xt&&this.Xt.zi()),this.eh()}xs(){this.bs||(this.qt||this.js?this.lh(6,0):this.lh(6,1),this.js&&this.$s.length>0&&(this.$s[0].Fs=this.Fs),super.xs(),this.Os.I&&(this.Gs=!1))}lh(t,s){if(this.Fi!==50*SCALE){let i=0;t>=4&&this.rh&&(i=this.Hs.x<0?1:this.Hs.x>0?2:3);for(const h of this.$s)h.yt(t,this.frame,s),0!==i&&h.yt(i,this.frame,s)}}As(s){if(this.$s.length>0)if(s.Gt&&s.Gt.active){if(this.gs=SCALE*Chai_DEFAULT_MOVE_SPEED/2,this.Fi=50*SCALE,!this.$s[0].Bs)for(const t of this.$s)t.Bs=!0}else if(this.$s[0].Bs&&(!this.Nt||!this.Nt.Gt||!this.Nt.Gt.active)){this.gs=SCALE*Chai_DEFAULT_MOVE_SPEED,this.Fi=75*SCALE,this.Eh=null;for(const s of this.$s)s.Bs=!1,s.frame=t.t(this.frame),s.hidden=!1;this.Ri=-6*this.$s.length-1,this.frame.x-=Math.floor(this.frame.x)%Math.floor(this.gs)}}ah(){super.ah(),this.Eh=null,this.Xt&&this.Xt.Qi(),this.Ah&&this.Ah.Qi()}Lh(){this.Xt=new H(this.frame.x+10*GameObject_BASE_SIZE*SCALE,this.frame.y,null),this.Xt.Ki(7),this.Xt.Os=this.Os,this.Xt.direction=-1,this.Xt.Ah=this}}class F{constructor(t,s){this.frame=null,this._h=[],this.animationDuration=.5,this.Et=0,this.uh=0,this.opacity=1,this.identity=0,this.Si=!1,this.mh=[],this.fh=0,this.Ih=0,this.gt,this.ph=0,this.frame=t;for(let t=1;t<=4;++t)this._h[t-1]=document.createElement("img"),this._h[t-1].setAttribute("src","./assets/chais/mittens/pixels/MittensPiece"+t+".png");this.identity=s}l(){if(this.Si&&(this.Et-this.uh)%3==0&&(this.frame=new t(this.frame.x-1*SCALE,this.frame.y-1*SCALE,this.frame.width+2*SCALE,this.frame.height+2*SCALE),this.opacity-=.1),this.opacity<=0)return;const s=Math.ceil(60*this.animationDuration/this._h.length);ctx.globalAlpha=this.opacity,ctx.drawImage(this._h[Math.floor(this.Et++/s)%this._h.length],this.frame.x+CAM_X_OFFSET,this.frame.y+CAM_Y_OFFSET,this.frame.width,this.frame.height),ctx.globalAlpha=1}collect(){100===this.identity||this.Si||(this.Si=!0,this.uh=this.Et%3,l.Y(!0,"M"+this.identity))}dh(t,s){const i=t.x-this.frame.x,h=t.y-this.frame.y,e=Math.sqrt(Math.pow(t.x-this.frame.x,2)+Math.pow(t.y-this.frame.y,2));this.ph=e/(s*SCALE),this.fh=i/this.ph,this.Ih=h/this.ph}}class k extends j{constructor(t,s,i){super(t,s),this.Ms=!0,this.identifier=-1,this.wh=!1,this.bh=!1,this.Ps=null,this.ih=-1,this.Bs=!1,this.hidden=!1,this.gh=[],this.Mh=!1,this.opacity=.2,this.Bh=1,this.Ys=!1,this.Ws=!1,this.Oh=!1,this.Gh=0,this.Ai=i,this.Ki(this.Ai)}l(){this.hidden||(super.l(),this.Ps||this.Mh||(this.opacity+=.01*this.Bh,(this.opacity>=1||this.opacity<=.2)&&(this.Bh=1===this.Bh?-1:1),ctx.globalAlpha=this.opacity,ctx.font=20*SCALE+"px MunroSmall",ctx.fillStyle="white",ctx.fillText("!",this.frame.x+this.frame.width/2-2*SCALE+2*(1===this.direction)*SCALE+CAM_X_OFFSET,this.frame.y-5*SCALE+CAM_Y_OFFSET),ctx.globalAlpha=1))}Dh(){this.Mh=!0}xh(i){return!(!s(this.frame,i.frame)||i.js||i.bs||!i.Nt)&&(i.$s.push(this),this.Ps=i,this.ih=i.$s.length,this.bh=!0,this.frame=t.t(i.frame),!0)}Th(){if(this.vi&&this.xs(),this.Bs)this.hidden||(this.frame.x+=b.fs(this.frame,{x:this.Ps.frame.x,y:this.Ps.frame.y},4),this.frame.y+=b.Is(this.frame,{x:this.Ps.frame.x,y:this.Ps.frame.y},4),s(this.frame,new t(this.Ps.frame.x+this.Ps.frame.width/2,this.Ps.frame.y+this.Ps.frame.height/2,1*SCALE,1*SCALE))&&(this.hidden=!0,this.ih===this.Ps.$s.length&&(this.Ps.Eh=new N(this.Ai))));else{if(!this.Vs&&(this.wh=!1,this.bs||this.js||this.Ps.bs||this.Ps.js||(0!==this.Ps.Hs.x&&this.Ps.Pt?this.frame.x>this.Ps.frame.x&&this.Ps.kt<0?this.left():this.frame.x<this.Ps.frame.x&&this.Ps.kt>0&&this.right():this.frame.x>this.Ps.frame.x+10*this.ih*SCALE||1===this.Ps.direction&&this.frame.x>this.Ps.frame.x-10*this.ih*SCALE?(-1===this.Ps.direction&&(this.Ws=!1),this.left()):this.frame.x<this.Ps.frame.x-10*this.ih*SCALE||-1===this.Ps.direction&&this.frame.x<this.Ps.frame.x+10*this.ih*SCALE?(1===this.Ps.direction&&(this.Ys=!1),this.right()):(this.kh()&&(this.direction=1===this.direction?-1:1),0!==this.Hs.x&&this.Xs())),this.gh.length>0&&!this.js))for(let t=0;t<this.gh.length;t++)if(this.gh[t].Fh>=4&&this.gh[t].jh>0){const s={x:this.gh[t].Hh.x,y:this.gh[t].Hh.y};s.y===this.frame.y&&(this.frame.x>s.x?(this.Ws=!1,this.left()):this.frame.x<s.x?(this.Ys=!1,this.right()):(this.Xs(),2===this.gh[t].jh?this.gh.splice(t,1):this.gh[t].jh=0)),t=100}this.Ch(),this.zi(),this.eh(),this.hh(),this.Pt&&(this.direction=this.Ps.direction,0===this.Ps.Hs.x&&0===this.Hs.y&&this.Xs())}}kh(){return 1===this.direction&&this.frame.x>this.Ps.frame.x||-1===this.direction&&this.frame.x<this.Ps.frame.x}Ch(){for(let t=0;t<this.gh.length;t++)i(this.gh[t].Hh,this.frame)?(this.Zh(this.gh[t].Fh),this.gh.splice(t--,1)):(++this.gh[t].yh,this.gh[t].yh>=7*this.Ps.$s.length&&(1===this.gh[t].jh?this.gh[t].jh=2:this.gh.splice(t--,1)))}yt(t,s,i){this.gh.push(new Z(s,t,i))}Zh(t){switch(t){case 1:this.Ws=!1,this.wh=!0,this.left();break;case 2:this.Ys=!1,this.wh=!0,this.right();break;case 3:this.wh||this.Xs();break;case 4:this.th(),this.Xs(),this.Fs=this.frame.y-75*SCALE;break;case 5:this.sh(),this.Xs(),this.Fs=this.frame.y-38*SCALE;break;case 6:this.xs();break;case 7:this.Xs()}}left(){this.Ws||super.left()}right(){this.Ys||super.right()}}class Z{constructor(s,i,h){this.Hh=t.t(s),this.Fh=i,this.jh=h,this.yh=0}}class y{static Rh(t,s,i,h){let e=!0;t.Oh=!1,s.C&&(Math.floor(s.frame.x)%Math.floor(s.frame.width)!=0||Math.floor(t.Nt.frame.x)%Math.floor(t.Nt.frame.width)!=0||Math.floor(s.frame.x)!==Math.floor(t.Nt.frame.x)-20*SCALE&&Math.floor(s.frame.x)!==Math.floor(t.Nt.frame.x)+20*SCALE||Math.floor(s.frame.x)!==20*s.index.x*SCALE||s.frame.y!==t.Nt.frame.y||(e=!1)),e&&(t.Gh=h,0===t.Ps.Hs.x&&t.Xs(),t.Nt.index.x>i?t.frame.x<=t.Nt.frame.x&&1===t.Ps.direction&&(t.Ws=!0,t.frame.x+t.frame.width/2<=t.Nt.frame.x&&t.Xs()):t.frame.x>=t.Nt.frame.x+t.Nt.frame.width-t.frame.width&&-1===t.Ps.direction&&(t.Ys=!0,t.frame.x+t.frame.width/2>=t.Nt.frame.x+t.Nt.frame.width&&t.Xs())),t.Gh===h&&(t.Oh=!0)}}class N{constructor(s){this.endpoints=[],this.Vh="",this.frame=new t(0,0,8*SCALE,11*SCALE),this.Nh=[],this.opacity=.7;for(let s=0;s<12;++s)this.Nh.push(new t(0,0,2*SCALE,2*SCALE)),this.endpoints.push(this.endpoint(s));this.Vh=N.Ph(s)}l(t){this.Wh(),ctx.globalAlpha=this.opacity,ctx.fillStyle=this.Vh;for(let s=0;s<12;++s){const i=this.Nh[s];ctx.fillRect(t.x+i.x+CAM_X_OFFSET,t.y+i.y+CAM_Y_OFFSET,i.width,i.height)}ctx.globalAlpha=1}Wh(){for(let t=0;t<12;++t){const s=this.Nh[t];this.opacity>=.1?(s.x+=b.fs(s,this.endpoints[t],.2),s.y+=b.Is(s,this.endpoints[t],.2)):(s.x=this.frame.width/2-1*SCALE,s.y=this.frame.height/2-1*SCALE)}this.opacity>=.1?this.opacity-=.013:this.opacity=.7}endpoint(t){switch(t){case 0:return{x:0,y:0};case 1:return{x:this.frame.width/2-1*SCALE,y:0};case 2:return{x:this.frame.width-2*SCALE,y:0};case 3:return{x:this.frame.width-2*SCALE,y:.25*this.frame.height};case 4:return{x:this.frame.width-2*SCALE,y:.5*this.frame.height};case 5:return{x:this.frame.width-2*SCALE,y:.75*this.frame.height};case 6:return{x:this.frame.width-2*SCALE,y:this.frame.height-2*SCALE};case 7:return{x:this.frame.width/2-1*SCALE,y:this.frame.height-2*SCALE};case 8:return{x:0,y:this.frame.height-2*SCALE};case 9:return{x:0,y:.75*this.frame.height};case 10:return{x:0,y:.5*this.frame.height};case 11:return{x:0,y:.25*this.frame.height}}}static Ph(t){switch(t){case 1:return"green";case 2:return"blue";case 3:return"orange";case 4:return"red";case 5:return"purple";case 6:return"magenta"}}}class V{constructor(t){this.i=t.i,this.A=[];for(let s=0;s<t.i.length;++s)for(const h of t.i[s])h.S&&(h.Us&&t.Xh&&i(h.frame,t.Xh.frame)&&h.Qs(),h.Mt&&this.A.push(h));this.Ai=t.Ai,this.Yh=t.Yh,this.name=t.Uh,this.Kh=t.Kh,this.qh=t.qh,this.zh=t.zh,this.Jh=t.Jh,this.Qh=t.Qh,this.$h=t.te,this.h=t.h,this.keys=t.keys,this.Mi=t.Mi,this.se=t.se,this.o=t.o,this.ie=t.ie,this.he=t.he,this.ee=t.ae,this.ne=[]}ce(){for(const t of this.keys)t.l();for(const t of this.ne)t.l();for(const t of this.Qh)t.l()}}class D{static Se(t,s,i=null,h=-1,e=-1){const n={};if(i)n.Js=i.Js,n.oe=i.qs,h=i.zs;else{n.Js=[];for(let t=0;t<3;t++)l.K("chai"+t)&&n.Js.push(t);n.oe=l.U("checkpoint-dir")}return n.Ai=self.Ai,n.re=h,n.Xh=i,this.Ae(t,s,n)}static Ae(s,i,h){let e,n=[],S=0,a=0,A=0,E=!1,c=!1,r=0,C=0,_=0;const L=[],f=[],u=[],p=[],I=[],w=[],b=[],T=[];let x=!1,j=null,H=null,Z=[],y=0,N="";const D=[];let v="",W="",P=0,X=!1,Y=!1,R=-1,U=-1,K=-1;h.re&&(R=h.re),h.Js&&(Z=h.Js),h.oe&&(x=1===h.oe),h.Ai&&(_=h.Ai),e=o.g(s),n=e.split("\n");let z=n.indexOf("");for(;-1!==z;)n.splice(z,1),z=n.indexOf("");for(let t=0;t<n.length;++t)if("#"!==n[t][0]){let s=n[t].split("| ");L.push([]);for(let t=0;t<s.length;++t){const i=s[t].split(", ");L[L.length-1].push(i)}}else switch(++A,A){case 2:S=t;break;case 3:a=t;break;case 4:n.splice(t)}const J=[];for(let s=0;s<S+1;++s)if("checkpoint"===L[s][0][0]){C++;const t=o.B(n[s+1]),i=new O(GameObject_BASE_SIZE*SCALE*parseInt(t[0][1][0]),GameObject_BASE_SIZE*SCALE*parseInt(t[0][1][1]));i.zs=C,J.push(i),i.zs===h.re&&(j=i.Ks)}else if("chai"===L[s][0][0]){const i=o.B(n[s+1]);let h=_;3===i[0].length&&(h=parseInt(i[0][2][0]));const e=new k(SCALE*parseInt(i[0][1][0]),SCALE*parseInt(i[0][1][1]),h);e.identifier=u.length,Z.includes(e.identifier)&&(e.frame=new t(j.x,j.y,e.frame.width,e.frame.height)),u.push(e)}else if("exit"===L[s][0][0]){const i=o.B(n[s+1]);let h=_;i[0].length>6&&(h=parseInt(i[0][6][0]));const e=new G(new t(SCALE*parseInt(i[0][1][0]),SCALE*parseInt(i[0][1][1]),GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE),parseInt(i[0][3][0]),h,i[0][4][0],new t(SCALE*parseInt(i[0][2][0]),SCALE*parseInt(i[0][2][1]),SCALE*parseInt(i[0][2][2]),SCALE*parseInt(i[0][2][3])),parseInt(i[0][5][0]));I.push(e)}else if("spawn"===L[s][0][0]){const t={x:SCALE*parseInt(L[s][0][1]),y:SCALE*parseInt(L[s][0][2])},i=1===parseInt(L[s][0][3]);p.push([t,i])}else if("dontChangeColor"===L[s][0][0])E=!0;else if("mustChangeColor"===L[s][0][0])c=!0;else if("size"===L[s][0][0])H={width:SCALE*parseInt(L[s][0][1]),height:SCALE*parseInt(L[s][0][2])};else if("special"===L[s][0][0])y=parseInt(L[s][0][1]);else if("key"===L[s][0][0]){if(r++,!l.K("A"+_+"K"+r)){const t=new B(parseInt(L[s][0][1])*SCALE,parseInt(L[s][0][2])*SCALE,_,r);4===L[s][0].length&&(t.ci=!1),w.push(t)}}else if("lock"===L[s][0][0]){if(!l.K("A"+_+"L"+parseInt(L[s][0][1]))){const t=new M(parseInt(L[s][0][2])*SCALE,parseInt(L[s][0][3])*SCALE,L[s][0][4],parseInt(L[s][0][1]),!1);t.ps=!1,t.Ai=_,t.index={x:t.frame.x/(GameObject_BASE_SIZE*SCALE),y:t.frame.y/(GameObject_BASE_SIZE*SCALE)},J.push(t)}}else if("name"===L[s][0][0])N=L[s][0][1];else if("mittens"===L[s][0][0]){if(!l.K("M"+parseInt(L[s][0][1]))){const i=new F(new t((parseInt(L[s][0][2])+GameObject_BASE_SIZE/4)*SCALE,(parseInt(L[s][0][3])+GameObject_BASE_SIZE/4)*SCALE,GameObject_BASE_SIZE/2*SCALE,GameObject_BASE_SIZE/2*SCALE),parseInt(L[s][0][1]));b.push(i)}}else if("lockM"===L[s][0][0]){const t=new M(parseInt(L[s][0][2])*SCALE,parseInt(L[s][0][3])*SCALE,L[s][0][4],parseInt(L[s][0][1]),!0);t.ps=!1,t.Ai=_,J.push(t),T.push(t)}else"exitP"===L[s][0][0]?(v=L[s][0][1],"PREVIOUS"!==L[s][0][2]?(W=L[s][0][2],P=parseInt(L[s][0][3])):(W=l._("level"),P=l.U("spawn"))):"nopause"===L[s][0][0]?X=!0:"index"===L[s][0][0]?U=parseInt(L[s][0][1]):"music"===L[s][0][0]?K=parseInt(L[s][0][1]):"area"===L[s][0][0]?_=parseInt(L[s][0][1]):"nostatus"===L[s][0][0]&&(Y=!0);j||(j=p[i%100-1][0],x=p[i%100-1][1]),SCALE*H.width<CANVAS_WIDTH&&(H.width=CANVAS_WIDTH),SCALE*H.height<CANVAS_HEIGHT&&(H.height=CANVAS_HEIGHT);for(let t=0;t<H.width/(GameObject_BASE_SIZE*SCALE)+2;++t){f.push([]);for(let s=0;s<H.height/(GameObject_BASE_SIZE*SCALE)+2;++s)f[t].push([])}for(const t of J)t.frame.x<H.width&&t.frame.y<H.height&&(f[Math.floor(t.frame.x/(GameObject_BASE_SIZE*SCALE))][Math.floor(t.frame.y/(GameObject_BASE_SIZE*SCALE))]=t);for(let t=S+1;t<a;++t){const s=o.B(n[t]),i=new d(SCALE*parseInt(s[0][1][0]),SCALE*parseInt(s[0][1][1]),s[0][2][0]);if((E||s[0].length>=4&&"X"===s[0][3][0])&&(i.ps=!1),c&&(i.ps=!0),s.length>1){i.Mt=!0;for(let t=1;t<s.length;t++)i.yt(m.ls(s[t])),"front"===s[t][0][0]&&(i.Tt=!0,D.push(i))}i.index={x:parseInt(s[0][0][0]),y:parseInt(s[0][0][1])},i.index.x<4e3&&(f[i.index.x][i.index.y]=i)}for(let t=a+1;t<n.length;++t){const s=o.B(n[t]),i=new g(SCALE*parseInt(s[0][1][0]),SCALE*parseInt(s[0][1][1]),parseInt(s[0][2][0]));if(s.length>1){i.Mt=!0;for(let t=1;t<s.length;t++)i.yt(m.ls(s[t])),"front"===s[t][0][0]&&(i.Tt=!0,D.splice(0,0,i))}i.index={x:parseInt(s[0][0][0]),y:parseInt(s[0][0][1])},f[i.index.x][i.index.y]=i}return new V({i:f,Ai:_,Yh:i,Uh:N,Kh:U,qh:H,h:I,keys:w,Mi:b,se:T,zh:K,Jh:{Ee:j,oe:x},Qh:u,te:Z.length,o:D,Xh:h.Xh,ie:y,he:X,ae:{text:v,level:W,hi:P}})}}class v{constructor(t,s,i){this.level=t,this.ri=s,this.Ce=i,this.le="",this.Le=0}_e(t,s){this.le=t,this.Le=s,this.ri.Zi=!0}static ue(t,s,i,h){switch(t){case 1:return new W(i,s,h);case 2:return new X(i,s,h);case 3:return new P(i,s,h);case 4:return new R(i,s,h);case 5:return new Y(i,s,h);case 6:return new J(i,s,h);case 7:return new U(i,s,h);case 8:return new q(i,s,h);case 9:return new K(i,s,h);case 10:return new z(i,s,h);case 11:return new Q(i,s,h);case 12:return new $(i,s,h)}return null}}class W extends v{constructor(s,i,h){if(super(s,i,h),this.me=[],this.moveEnd=0,this.fe=!1,this.Ie=!1,this.pe=!1,this.de=!1,this.we=!1,this.be=!1,this.ge=!1,this.Me(),this.level.Yh%100==8){for(let t=41;t<=43;++t)this.level.i[t][87].frame.x=820*SCALE+Math.abs(41-t)*GameObject_BASE_SIZE*SCALE,this.level.i[t][87].frame.y=1900*SCALE,this.level.i[t][87].Ft=-1*SCALE,this.level.i[t][87].Bt=!0,this.level.i[t][87].ys(Math.ceil(this.level.Yh/100)+1),this.ri.Ri=1,this.me.push(this.level.i[t][87]),this.level.A.includes(this.level.i[t][87])||this.level.A.push(this.level.i[t][87]);if(8!==this.level.Yh||l.K("BA2"))this.moveEnd=1740*SCALE;else{this.moveEnd=1600*SCALE;for(let t=41;t<=43;++t)this.level.i[t][80].frame.x=-40,this.level.i[t][80].frame.y=-40}}const e=[[740*SCALE,1390*SCALE],[740*SCALE,1530*SCALE],[740*SCALE,1670*SCALE],[940*SCALE,1390*SCALE],[940*SCALE,1530*SCALE],[940*SCALE,1670*SCALE]];for(let s=1;s<=6;++s){if(!l.K("BA"+s)){let i=3;s>=4&&(i=4);const h=new G(new t(e[s-1][0],e[s-1][1],GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE),i,s,"decor",new t(0,0,0,0),0);return void this.level.ne.push(h)}{let t=0,i=0;switch(s){case 1:t=40,i=74;for(let t=41;t<=43;++t)this.level.i[t][73].frame.x=t*GameObject_BASE_SIZE*SCALE,this.level.i[t][73].frame.y=73*GameObject_BASE_SIZE*SCALE+70*SCALE,this.level.A.push(this.level.i[t][73]),this.level.i[t][73].Bt=!0;break;case 2:t=40,i=81;for(let t=41;t<=43;++t)this.level.i[t][80].frame.x=t*GameObject_BASE_SIZE*SCALE,this.level.i[t][80].frame.y=80*GameObject_BASE_SIZE*SCALE+70*SCALE,this.level.A.push(this.level.i[t][80]),this.level.i[t][80].Bt=!0;break;case 4:t=44,i=74;break;case 5:t=44,i=81}if(0!==t&&508!==this.level.Yh)for(let s=i;s<i+6;++s)this.level.i[t][s].frame.x=-40,this.level.i[t][s].frame.y=-40}}this.moveEnd=1880*SCALE,this.be=!0}update(){if(this.me.length>0&&this.me[0].frame.y===this.moveEnd){for(let t=0;t<this.me.length;++t)this.me[0].Ft=0,this.me.splice(t,1),--t;if(this.ri.Ri=0,this.ge){this.ge=!1;for(let t=41;t<=43;++t)this.level.i[t][87].frame.x=-40,this.level.i[t][87].frame.y=-40}if(this.be){this.moveEnd=97*GameObject_BASE_SIZE*SCALE,this.be=!1,this.ge=!0;for(let t=95;t<=97;++t)this.level.i[42][t].Ft=1*SCALE,this.level.i[42][t].Bt=!0,this.me.push(this.level.i[42][t]),this.level.A.includes(this.level.i[42][t])||this.level.A.push(this.level.i[42][t])}}0===this.me.length&&this.Me()}Me(){if((s(this.ri.frame,new t(665*SCALE,1480*SCALE,10*SCALE,120*SCALE))||l.K("H2A"))&&!this.fe){this.ri.xs(),this.fe=!0;for(let t=26;t<=31;++t)this.level.A.push(this.level.i[t][79-(t-26)]),this.level.i[t][79-(t-26)].Bt=!0,l.K("H2A")?this.level.i[t][79-(t-26)].frame.y+=20*(t-25)*SCALE:(this.level.i[t][79-(t-26)].Ft=(t-25)/2*SCALE,this.me.push(this.level.i[t][79-(t-26)]),this.ri.Ri=-40,this.moveEnd=1600*SCALE);l.Y(!0,"H2A")}if((s(this.ri.frame,new t(525*SCALE,1620*SCALE,5*SCALE,120*SCALE))||l.K("H3A"))&&!this.Ie){this.ri.xs(),this.Ie=!0;for(let t=19;t<=24;++t)this.level.A.push(this.level.i[t][86-(t-19)]),this.level.i[t][86-(t-19)].Bt=!0,l.K("H3A")?this.level.i[t][86-(t-19)].frame.y+=20*(t-18)*SCALE:(this.level.i[t][86-(t-19)].Ft=(t-18)/2*SCALE,this.me.push(this.level.i[t][86-(t-19)]),this.ri.Ri=-40,this.moveEnd=1740*SCALE);l.Y(!0,"H3A")}if((s(this.ri.frame,new t(1025*SCALE,1260*SCALE,5*SCALE,200*SCALE))||l.K("H4A"))&&l.K("BA3")&&!this.pe){this.ri.xs(),this.pe=!0;for(let t=53;t<=59;++t)this.level.A.push(this.level.i[t][72-(t-53)]),this.level.i[t][72-(t-53)].Bt=!0,l.K("H4A")?this.level.i[t][72-(t-53)].frame.y+=20*(t-52)*SCALE:(this.level.i[t][72-(t-53)].Ft=(t-52)/2*SCALE,this.me.push(this.level.i[t][72-(t-53)]),this.ri.Ri=-40,this.moveEnd=1460*SCALE);l.Y(!0,"H4A")}if((s(this.ri.frame,new t(1025*SCALE,1480*SCALE,5*SCALE,120*SCALE))||l.K("H5A"))&&!this.de){this.ri.xs(),this.de=!0;for(let t=53;t<=58;++t)this.level.A.push(this.level.i[t][t+21]),this.level.i[t][t+21].Bt=!0,l.K("H5A")?this.level.i[t][t+21].frame.y+=20*(59-t)*SCALE:(this.level.i[t][t+21].Ft=(59-t)/2*SCALE,this.me.push(this.level.i[t][t+21]),this.ri.Ri=-40,this.moveEnd=1600*SCALE);l.Y(!0,"H5A")}if((s(this.ri.frame,new t(1165*SCALE,1620*SCALE,10*SCALE,120*SCALE))||l.K("H6A"))&&!this.we){this.ri.xs(),this.we=!0;for(let t=60;t<=65;++t)this.level.A.push(this.level.i[t][t+21]),this.level.i[t][t+21].Bt=!0,l.K("H6A")?this.level.i[t][t+21].frame.y+=20*(66-t)*SCALE:(this.level.i[t][t+21].Ft=(66-t)/2*SCALE,this.me.push(this.level.i[t][t+21]),this.ri.Ri=-40,this.moveEnd=1740*SCALE);l.Y(!0,"H6A")}}}class P extends v{constructor(t,s,i){super(t,s,i),this.ri.Ri=-1e6,this.ri.Ui=!1}update(){if(this.ri.frame.y<=-75*SCALE){switch(this.level.Yh){case 1:this._e("MainHub",8),l.Y(!0,"BA1"),this.level.Ai=2;break;case 2:this._e("MainHub",108),l.Y(!0,"BA2"),this.level.Ai=3;break;case 3:this._e("MainHub",208),l.Y(!0,"BA3"),this.level.Ai=4;break;case 4:this._e("MainHub",308),l.Y(!0,"BA4"),this.level.Ai=5;break;case 5:this._e("MainHub",408),l.Y(!0,"BA5"),this.level.Ai=6;break;case 6:this._e("MainHub",508),l.Y(!0,"BA6"),this.level.Ai=7}this.ri.Nt&&(this.ri.Nt.frame.x=-40,this.ri.Nt.frame.y=-40)}}}class X extends v{constructor(s,i,h){super(s,i,h),this.me=[];for(let s=1;s<=11;++s){const i=s<=10?61-4*(s-1):19;if(s!==this.level.Yh||l.K("H1SA"+s)){if(l.K("H1SA"+s))for(let s=i;s>i-4;s--){const h=this.level.i[s][s-36+(61-i)];this.level.A.push(h),h.Bt=!0,h.frame=new t(h.frame.x,520*SCALE,GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE)}}else{for(let t=i;t>i-4;--t){const s=this.level.i[t][t-36+(61-i)];this.level.A.push(s),this.me.push(s),s.Ft=(i+1-t)/4*SCALE,s.Bt=!0}l.Y(!0,"H1SA"+s)}}for(let t=1;t<=10;t++)for(let s=1;s<=3;s++)if(l.U("C1-"+t)>=s){const i=new k(1146*SCALE-4*GameObject_BASE_SIZE*(t-1)*SCALE+GameObject_BASE_SIZE*s*SCALE,21*GameObject_BASE_SIZE*SCALE-11*SCALE,1);i.direction=1,i.Dh(),this.level.Qh.push(i)}const e=l.U("C1-"+(this.level.Yh-1));if(this.level.Yh<=11&&this.Ce>e){const t=this.Ce-e;l.Y(this.Ce,"C1-"+(this.level.Yh-1)),S(this.ri,this.level.qh);const s=-CAM_Y_OFFSET-20*SCALE;for(let i=e+1;i<=e+t;i++){const t=new k(1146*SCALE-80*(this.level.Yh-2)*SCALE+20*i*SCALE,s,1);t.direction=1,t.Dh(),this.level.Qh.push(t),t.xs(),t.Ri=-30*(i-(e+1))}}}update(){if(this.me.length>0&&this.me[0].frame.y===520*SCALE)for(let t=0;t<this.me.length;++t)this.me[t].Ft=0,this.me.splice(t--,1);for(let i=1;i<=10;i++)s(this.ri.frame,new t((1160-80*(i-1))*SCALE,440*SCALE,60*SCALE,3*SCALE))&&this._e("Level1-"+i,1)}}class R extends v{constructor(s,i,h){super(s,i,h),this.me=[];for(let s=1;s<=11;++s){const i=s<=10?61-4*(s-1):19;if(s!==this.level.Yh||l.K("H2SA"+s)){if(l.K("H2SA"+s))for(let s=i;s>i-4;s--){const h=this.level.i[s][s-36+(61-i)];this.level.A.push(h),h.Bt=!0,h.frame=new t(h.frame.x,520*SCALE,GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE)}}else{for(let t=i;t>i-4;--t){const s=this.level.i[t][t-36+(61-i)];this.level.A.push(s),this.me.push(s),s.Ft=(i+1-t)/4*SCALE,s.Bt=!0}l.Y(!0,"H2SA"+s)}}for(let t=1;t<=10;t++)for(let s=1;s<=3;s++)if(l.U("C2-"+t)>=s){const i=new k(1146*SCALE-4*GameObject_BASE_SIZE*(t-1)*SCALE+GameObject_BASE_SIZE*s*SCALE,21*GameObject_BASE_SIZE*SCALE-11*SCALE,2);i.direction=1,i.Dh(),this.level.Qh.push(i)}const e=l.U("C2-"+(this.level.Yh-1));if(this.level.Yh<=11&&this.Ce>e){const t=this.Ce-e;l.Y(this.Ce,"C2-"+(this.level.Yh-1)),S(this.ri,this.level.qh);const s=-CAM_Y_OFFSET-20*SCALE;for(let i=e+1;i<=e+t;i++){const t=new k(1146*SCALE-80*(this.level.Yh-2)*SCALE+20*i*SCALE,s,2);t.direction=1,t.Dh(),this.level.Qh.push(t),t.xs(),t.Ri=-30*(i-(e+1))}}}update(){if(this.me.length>0&&this.me[0].frame.y===520*SCALE)for(let t=0;t<this.me.length;++t)this.me[t].Ft=0,this.me.splice(t--,1);for(let i=1;i<=10;i++)s(this.ri.frame,new t((1160-80*(i-1))*SCALE,440*SCALE,60*SCALE,3*SCALE))&&this._e("Level2-"+i,1)}}class Y extends v{constructor(s,i,h){super(s,i,h),this.me=[];let e=0;for(let s=1;s<=12;++s)if(e=61-4*(s-1),s!==this.level.Yh||l.K("H3SA"+s)){if(l.K("H3SA"+s))for(let s=e;s>e-4;s--){const i=this.level.i[s][s-36+(61-e)];this.level.A.push(i),i.Bt=!0,i.frame=new t(i.frame.x,520*SCALE,GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE)}}else{for(let t=e;t>e-4;--t){const s=this.level.i[t][t-36+(61-e)];this.level.A.push(s),this.me.push(s),s.Ft=(e+1-t)/4*SCALE,s.Bt=!0}l.Y(!0,"H3SA"+s)}for(let t=1;t<=10;t++)for(let s=1;s<=3;s++)if(l.U("C3-"+t)>=s){const i=new k(1146*SCALE-4*GameObject_BASE_SIZE*(t-1)*SCALE+GameObject_BASE_SIZE*s*SCALE,21*GameObject_BASE_SIZE*SCALE-11*SCALE,3);i.direction=1,i.Dh(),this.level.Qh.push(i)}const n=l.U("C3-"+(this.level.Yh-1));if(this.level.Yh<=11&&this.Ce>n){const t=this.Ce-n;l.Y(this.Ce,"C3-"+(this.level.Yh-1)),S(this.ri,this.level.qh);const s=-CAM_Y_OFFSET-20*SCALE;for(let i=n+1;i<=n+t;i++){const t=new k(1146*SCALE-80*(this.level.Yh-2)*SCALE+20*i*SCALE,s,3);t.direction=1,t.Dh(),this.level.Qh.push(t),t.xs(),t.Ri=-30*(i-(n+1))}}if(l.K("BeatMinigame1Dif1")){const s=new F(new t(GameObject_BASE_SIZE*(e+2)*SCALE+GameObject_BASE_SIZE/4*SCALE,20*GameObject_BASE_SIZE*SCALE+GameObject_BASE_SIZE/4*SCALE,GameObject_BASE_SIZE/2*SCALE,GameObject_BASE_SIZE/2*SCALE),100);this.level.ne.push(s)}}update(){if(this.me.length>0&&this.me[0].frame.y===520*SCALE)for(let t=0;t<this.me.length;++t)this.me[t].Ft=0,this.me.splice(t--,1);for(let i=1;i<=11;i++)s(this.ri.frame,new t((1160-80*(i-1))*SCALE,440*SCALE,60*SCALE,3*SCALE))&&(11!==i?this._e("Level3-"+i,1):(this._e("Minigame1",1),l.Y(1,"Minigame1Dif"),l.Y(112,"spawn")))}}class U extends v{constructor(s,i,h){super(s,i,h),this.me=[];let e=0;for(let s=1;s<=12;++s)if(e=9+4*(s-1),s!==this.level.Yh||l.K("H4SA"+s)){if(l.K("H4SA"+s))for(let s=e;s<e+4;++s){const i=this.level.i[s][25-(s-e)];this.level.A.push(i),i.Bt=!0,i.frame=new t(i.frame.x,520*SCALE,GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE)}}else{for(let t=e;t<e+4;++t){const s=this.level.i[t][25-(t-e)];this.level.A.push(s),this.me.push(s),s.Ft=(t+1-e)/4*SCALE,s.Bt=!0}l.Y(!0,"H4SA"+s)}for(let t=1;t<=10;t++)for(let s=1;s<=3;s++)if(l.U("C4-"+t)>=s){const i=new k(186*SCALE+4*GameObject_BASE_SIZE*(t-1)*SCALE+GameObject_BASE_SIZE*s*SCALE,21*GameObject_BASE_SIZE*SCALE-11*SCALE,4);i.direction=1,i.Dh(),this.level.Qh.push(i)}const n=l.U("C4-"+(this.level.Yh-1));if(this.level.Yh<=11&&this.Ce>n){const t=this.Ce-n;l.Y(this.Ce,"C4-"+(this.level.Yh-1)),S(this.ri,this.level.qh);const s=-CAM_Y_OFFSET-20*SCALE;for(let i=n+1;i<=n+t;i++){const t=new k(186*SCALE+80*(this.level.Yh-2)*SCALE+20*i*SCALE,s,4);t.direction=1,t.Dh(),this.level.Qh.push(t),t.xs(),t.Ri=-30*(i-(n+1))}}if(l.K("BeatMinigame2Dif1")){const s=new F(new t(GameObject_BASE_SIZE*(e-2)*SCALE+GameObject_BASE_SIZE/4*SCALE,20*GameObject_BASE_SIZE*SCALE+GameObject_BASE_SIZE/4*SCALE,GameObject_BASE_SIZE/2*SCALE,GameObject_BASE_SIZE/2*SCALE),100);this.level.ne.push(s)}}update(){if(this.me.length>0&&this.me[0].frame.y===520*SCALE)for(let t=0;t<this.me.length;++t)this.me[t].Ft=0,this.me.splice(t--,1);for(let i=1;i<=11;i++)s(this.ri.frame,new t((200+80*(i-1))*SCALE,440*SCALE,60*SCALE,3*SCALE))&&(11!==i?this._e("Level4-"+i,1):(this._e("Minigame2",1),l.Y(1,"Minigame2Dif"),l.Y(112,"spawn")))}}class K extends v{constructor(s,i,h){super(s,i,h),this.me=[];let e=0;for(let s=1;s<=12;++s)if(e=9+4*(s-1),s!==this.level.Yh||l.K("H5SA"+s)){if(l.K("H5SA"+s))for(let s=e;s<e+4;++s){const i=this.level.i[s][25-(s-e)];this.level.A.push(i),i.Bt=!0,i.frame=new t(i.frame.x,520*SCALE,GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE)}}else{for(let t=e;t<e+4;++t){const s=this.level.i[t][25-(t-e)];this.level.A.push(s),this.me.push(s),s.Ft=(t+1-e)/4*SCALE,s.Bt=!0}l.Y(!0,"H5SA"+s)}for(let t=1;t<=10;t++)for(let s=1;s<=3;s++)if(l.U("C5-"+t)>=s){const i=new k(186*SCALE+4*GameObject_BASE_SIZE*(t-1)*SCALE+GameObject_BASE_SIZE*s*SCALE,21*GameObject_BASE_SIZE*SCALE-11*SCALE,5);i.direction=1,i.Dh(),this.level.Qh.push(i)}const n=l.U("C5-"+(this.level.Yh-1));if(this.level.Yh<=11&&this.Ce>n){const t=this.Ce-n;l.Y(this.Ce,"C5-"+(this.level.Yh-1)),S(this.ri,this.level.qh);const s=-CAM_Y_OFFSET-20*SCALE;for(let i=n+1;i<=n+t;i++){const t=new k(186*SCALE+80*(this.level.Yh-2)*SCALE+20*i*SCALE,s,5);t.direction=1,t.Dh(),this.level.Qh.push(t),t.xs(),t.Ri=-30*(i-(n+1))}}if(l.K("BeatMinigame1Dif2")){const s=new F(new t(GameObject_BASE_SIZE*(e-2)*SCALE+GameObject_BASE_SIZE/4*SCALE,20*GameObject_BASE_SIZE*SCALE+GameObject_BASE_SIZE/4*SCALE,GameObject_BASE_SIZE/2*SCALE,GameObject_BASE_SIZE/2*SCALE),100);this.level.ne.push(s)}}update(){if(this.me.length>0&&this.me[0].frame.y===520*SCALE)for(let t=0;t<this.me.length;++t)this.me[t].Ft=0,this.me.splice(t--,1);for(let i=1;i<=11;i++)s(this.ri.frame,new t((200+80*(i-1))*SCALE,440*SCALE,60*SCALE,3*SCALE))&&(11!==i?this._e("Level5-"+i,1):(this._e("Minigame1",1),l.Y(2,"Minigame1Dif"),l.Y(112,"spawn")))}}class z extends v{constructor(s,i,h){super(s,i,h),this.me=[];let e=0;for(let s=1;s<=12;++s)if(e=9+4*(s-1),s!==this.level.Yh||l.K("H6SA"+s)){if(l.K("H6SA"+s))for(let s=e;s<e+4;++s){const i=this.level.i[s][25-(s-e)];this.level.A.push(i),i.Bt=!0,i.frame=new t(i.frame.x,520*SCALE,GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE)}}else{for(let t=e;t<e+4;++t){const s=this.level.i[t][25-(t-e)];this.level.A.push(s),this.me.push(s),s.Ft=(t+1-e)/4*SCALE,s.Bt=!0}l.Y(!0,"H6SA"+s)}for(let t=1;t<=10;t++)for(let s=1;s<=3;s++)if(l.U("C6-"+t)>=s){const i=new k(186*SCALE+4*GameObject_BASE_SIZE*(t-1)*SCALE+GameObject_BASE_SIZE*s*SCALE,21*GameObject_BASE_SIZE*SCALE-11*SCALE,6);i.direction=1,i.Dh(),this.level.Qh.push(i)}const n=l.U("C6-"+(this.level.Yh-1));if(this.level.Yh<=11&&this.Ce>n){const t=this.Ce-n;l.Y(this.Ce,"C6-"+(this.level.Yh-1)),S(this.ri,this.level.qh);const s=-CAM_Y_OFFSET-20*SCALE;for(let i=n+1;i<=n+t;i++){const t=new k(186*SCALE+80*(this.level.Yh-2)*SCALE+20*i*SCALE,s,6);t.direction=1,t.Dh(),this.level.Qh.push(t),t.xs(),t.Ri=-30*(i-(n+1))}}if(l.K("BeatMinigame2Dif2")){const s=new F(new t(GameObject_BASE_SIZE*(e-2)*SCALE+GameObject_BASE_SIZE/4*SCALE,20*GameObject_BASE_SIZE*SCALE+GameObject_BASE_SIZE/4*SCALE,GameObject_BASE_SIZE/2*SCALE,GameObject_BASE_SIZE/2*SCALE),100);this.level.ne.push(s)}}update(){if(this.me.length>0&&this.me[0].frame.y===520*SCALE)for(let t=0;t<this.me.length;++t)this.me[t].Ft=0,this.me.splice(t--,1);for(let i=1;i<=11;i++)s(this.ri.frame,new t((200+80*(i-1))*SCALE,440*SCALE,60*SCALE,3*SCALE))&&(11!==i?this._e("Level6-"+i,1):(this._e("Minigame2",1),l.Y(2,"Minigame2Dif"),l.Y(112,"spawn")))}}class J extends v{constructor(t,s,i){super(t,s,i),this.Be=0,this.Et=0,this.Oe=[],this.speed=0,this.Ge=0,this.De=[],this.xe=null,this.Te=0,this.ke=[],this.Fe=0,this.label=null,this.je=2,this.He=[],this.ve=[],this.Ze=0,this.ye=!1,this.Be=l.U("Minigame1Dif"),1===this.Be?this.Fe=8:this.Fe=10,this.top=Math.floor(CANVAS_HEIGHT/(GameObject_BASE_SIZE*SCALE)/2-3);for(let t=0;t<Math.ceil(CANVAS_WIDTH/(GameObject_BASE_SIZE*SCALE));++t){for(let s=this.top;s<=this.top+6;s+=6){const i=new d(t*GameObject_BASE_SIZE*SCALE,s*GameObject_BASE_SIZE*SCALE,"G");i.index={x:t,y:s},this.level.i[t][s]=i}if(0===t||t===Math.ceil(CANVAS_WIDTH/(GameObject_BASE_SIZE*SCALE))-1){let s=GameObject_BASE_SIZE/2*SCALE,i=GameObject_BASE_SIZE*SCALE,h=4;0!==t&&(s=t*GameObject_BASE_SIZE*SCALE-(CANVAS_WIDTH-GameObject_BASE_SIZE/2*SCALE),i=-GameObject_BASE_SIZE*SCALE,h=3);for(let e=this.top+1;e<=this.top+5;e++){const n=new g(t*GameObject_BASE_SIZE*SCALE-s,e*GameObject_BASE_SIZE*SCALE,h);n.index={x:t,y:e},this.level.A.push(n),this.De.push(n);const S=new d(n.frame.x-i,n.frame.y,"G");S.index={x:t+1,y:e},this.level.A.push(S),this.De.push(S),0===t?(n.tag=1,S.tag=1):(n.tag=-1,S.tag=-1)}}}this.ri.frame.x=CANVAS_WIDTH/2-this.ri.frame.width/2,this.ri.frame.y=(this.top+5)*GameObject_BASE_SIZE*SCALE+9*SCALE,this.speed=2,this.Ge=80}update(){if(this.label&&this.je>0&&(this.je-=.01,this.je<0?(this.je=0,this.label.st()):this.je<1&&this.label.at(this.je)),this.xe&&this.xe.opacity<1){this.xe.opacity+=.01;const t=[];for(let s=0;s<this.level.A.length;++s){const i=this.level.A[s];i.opacity-=.015,i.opacity<=0&&t.push(i)}for(let s=t.length-1;s>=0;--s)this.level.A.splice(t[s],1)}if(this.Te>0&&--this.Te,1===this.Te)return this._e(l._("level"),l.U("spawn")-100),l.Y(!0,"BeatMinigame1Dif"+this.Be),void l.Y(0,"MGP");if(this.xe&&s(this.ri.frame,this.xe.frame)&&0===this.Te&&(this.Te=200),++this.Et,this.Et===this.Ge){for(let t=0;t<this.Oe.length;++t){const s=this.Oe[t];s.Gt&&s.Gt.active||(this.level.A.splice(this.level.A.findIndex((t=>t===s)),1),this.Oe.splice(t--,1))}this.Re(),this.Et=0,this.Ze++,this.Ve(),this.Ze%7==0&&(this.Ze<=28||2===this.Be&&this.Ze<=42)&&3!==this.Be&&this.Ne()}if(this.ke.length>0)for(let t=0;t<this.ke.length;++t)this.ke[t].frame.x>CANVAS_WIDTH?this.ke.splice(t--,1):this.ke[t].frame.x+=2*SCALE}Re(){let s=0;const i=o.g("minigames/1/MG1-"+Math.floor(Math.random()*this.Fe),!0).split("\n");for(const t of i){const i=t.split(", ");parseInt(i[1])*SCALE>s&&(s=parseInt(i[1])*SCALE)}let h=0==Math.floor(2*Math.random());for(const e of i){const i=e.split(", ");let n=0;n=h?CANVAS_WIDTH+parseInt(i[1])*SCALE:parseInt(i[1])*SCALE-s-GameObject_BASE_SIZE*SCALE;let S=0;if(S=h?-2*GameObject_BASE_SIZE*SCALE:CANVAS_WIDTH+2*GameObject_BASE_SIZE*SCALE,"b"===i[0]){const s=new d(n,parseInt(i[2])*SCALE+(this.top+1)*GameObject_BASE_SIZE*SCALE,i[3]);s.Mt=!0,s.Ot=I._s(this.speed,new t(S,s.frame.y,s.frame.width,s.frame.height),this.ri),this.level.A.splice(0,0,s),this.Oe.push(s)}else{const s=new g(n,parseInt(i[2])*SCALE+(this.top+1)*GameObject_BASE_SIZE*SCALE,parseInt(i[3]));s.Ot=I._s(this.speed,new t(S,s.frame.y,s.frame.width,s.frame.height),this.ri),this.level.A.splice(0,0,s),this.Oe.push(s)}}}Ve(){if(1===this.Be)switch(this.Ze){case 1:this.Ge=180;break;case 3:this.Pe(GameObject_BASE_SIZE*SCALE+(CANVAS_WIDTH-480*SCALE)/2);break;case 7:this.speed=2.5;break;case 10:this.Pe(2*GameObject_BASE_SIZE*SCALE),this.Ge=150;break;case 15:this.Ge=130;break;case 20:this.Pe(2*GameObject_BASE_SIZE*SCALE),this.Ge=110;break;case 25:this.Ge=100,this.speed=3,this.Pe(2.5*GameObject_BASE_SIZE*SCALE);break;case 30:this.Pe(.5*GameObject_BASE_SIZE*SCALE),this.Ge=90;break;case 32:this.Pe(.5*GameObject_BASE_SIZE*SCALE);break;case 35:this.Ge=-1,this.We()}else switch(this.Ze){case 1:this.Ge=180;break;case 3:this.Pe(GameObject_BASE_SIZE*SCALE+(CANVAS_WIDTH-480*SCALE)/2);break;case 7:this.speed=2.5;break;case 10:this.Pe(2*GameObject_BASE_SIZE*SCALE),this.Ge=150;break;case 15:this.Ge=130;break;case 20:this.Pe(2*GameObject_BASE_SIZE*SCALE),this.Ge=110;break;case 25:this.Ge=100,this.speed=3,this.Pe(2.5*GameObject_BASE_SIZE*SCALE);break;case 30:this.Pe(.5*GameObject_BASE_SIZE*SCALE),this.Ge=90,this.speed=3.25;break;case 32:case 35:case 38:this.Pe(.5*GameObject_BASE_SIZE*SCALE);break;case 47:3!==this.Be&&(this.Ge=-1,this.We());break;case 50:case 70:this.Pe(.5*GameObject_BASE_SIZE*SCALE);break;case 100:this.Pe(.25*GameObject_BASE_SIZE*SCALE)}}Pe(s){for(const i of this.De){let h;i.Gt=null,i.Bt=!1,h=i.tag>0?new t(i.frame.x+s,i.frame.y,i.frame.width,i.frame.height):new t(i.frame.x-s,i.frame.y,i.frame.width,i.frame.height),i.Ot=I._s(3,h,this.ri)}}We(){let s=0;switch(this.Be){case 1:s=19,this.level.Kh=36;break;case 2:s=39,this.level.Kh=62}this.xe=new F(new t(.75*CANVAS_WIDTH,(this.top+5)*GameObject_BASE_SIZE*SCALE+5*SCALE,GameObject_BASE_SIZE/2*SCALE,GameObject_BASE_SIZE/2*SCALE),s),this.level.Mi.push(this.xe),this.xe.opacity=0}Ne(){for(let t=this.top;t<=this.top+6;t+=6){let s;s=t===this.top?-GameObject_BASE_SIZE*SCALE:GameObject_BASE_SIZE*SCALE;const i=new O(-GameObject_BASE_SIZE*SCALE,t*GameObject_BASE_SIZE*SCALE+s);i.opacity=1,this.level.ne.push(i),this.ke.push(i)}l.K("BeatMinigame1Dif"+this.Be)||3===this.Be||l.Y(this.Ze,"MGP")}Xe(t){t>=42&&2===this.Be?(this.Pe(10*SCALE+30*SCALE+50*SCALE+40*SCALE+40*SCALE+(20*SCALE+(CANVAS_WIDTH-480*SCALE)/2)),this.speed=3.25,this.Ge=90,this.Ze=42):t>=35&&2===this.Be?(this.Pe(30*SCALE+50*SCALE+40*SCALE+40*SCALE+(20*SCALE+(CANVAS_WIDTH-480*SCALE)/2)),this.speed=3.25,this.Ge=90,this.Ze=35):t>=28?(this.Pe(50*SCALE+40*SCALE+40*SCALE+(20*SCALE+(CANVAS_WIDTH-480*SCALE)/2)),this.speed=3,this.Ge=110,this.Ze=28):t>=21?(this.Pe(40*SCALE+40*SCALE+(20*SCALE+(CANVAS_WIDTH-480*SCALE)/2)),this.speed=2.5,this.Ge=110,this.Ze=21):t>=14?(this.Pe(40*SCALE+(20*SCALE+(CANVAS_WIDTH-480*SCALE)/2)),this.speed=2.5,this.Ge=150,this.Ze=14):t>=7&&(this.Pe(20*SCALE+(CANVAS_WIDTH-480*SCALE)/2),this.speed=2.5,this.Ge=180,this.Ze=7),this.Et=this.Ge-20,this.ye||(this.label=new L("Survive as long as possible!",25*SCALE+"px MunroSmall",{width:CANVAS_WIDTH,left:0,top:.4*CANVAS_HEIGHT}),this.label.at(1),this.label.$(),this.ye=!0)}}class q extends v{constructor(t,s,i){super(t,s,i),this.Be=0,this.Et=0,this.Ye=!1,this.Ue=[],this.Oe=[],this.speed=0,this.Ke=0,this.qe=[],this.xe=null,this.ze=[],this.Te=0,this.dir=0,this.Je=null,this.Qe=null,this.ke=[],this.Fe=0,this.label=null,this.je=2,this.Ze=0,this.ye=!1,this.Be=l.U("Minigame2Dif"),this.Fe=1===this.Be?7:10;const h=CANVAS_WIDTH%(Chai_DEFAULT_MOVE_SPEED*SCALE);this.$e=0===h?CANVAS_WIDTH:CANVAS_WIDTH+(Chai_DEFAULT_MOVE_SPEED*SCALE-h);const e=(this.$e/2-5.5*GameObject_BASE_SIZE*SCALE)/(GameObject_BASE_SIZE*SCALE),n=(this.$e/2+5.5*GameObject_BASE_SIZE*SCALE)/(GameObject_BASE_SIZE*SCALE),S=e*GameObject_BASE_SIZE*SCALE%(Chai_DEFAULT_MOVE_SPEED*SCALE);for(let t=e-.5;t<=n+1;t+=11)for(let s=0;s<Math.ceil(CANVAS_HEIGHT/(GameObject_BASE_SIZE*SCALE));++s){const i=new d(t*GameObject_BASE_SIZE*SCALE-S,s*GameObject_BASE_SIZE*SCALE,"G");i.index={x:t,y:s},this.level.i[Math.floor(t)][s]=i,this.qe.push(i)}const a=(this.qe[0].frame.x+GameObject_BASE_SIZE*SCALE)/(GameObject_BASE_SIZE*SCALE);for(let t=a;t<a+10;++t){const s=new d(t*GameObject_BASE_SIZE*SCALE,this.ri.frame.y+11*SCALE,"G");s.index={x:t,y:3},this.level.i[Math.floor(t)][3]=s,this.Ue.push(s)}this.ri.frame.x=this.$e/2-this.ri.frame.width/2,this.ri.Zs=1e7,this.ri.vs=1e7,this.speed=1}update(){if(this.label&&this.je>0&&(this.je-=.01,this.je<0?(this.je=0,this.label.st()):this.je<1&&this.label.at(this.je)),this.level.i[Math.floor(this.Ue[0].index.x)][3].S){if(this.Et>15&&this.Et%15==0)for(let t=0;t<this.Ue.length;++t)this.Ue[t].opacity=0===this.Ue[t].opacity?1:0;if(this.Et>120&&1===this.Ue[0].opacity){for(let t=0;t<this.Ue.length;++t)this.level.i[Math.floor(this.Ue[t].index.x)][3]=[],this.Ue[t]==this.ri.qt&&(this.ri.qt=null,this.ri.xs());this.Ye=!0,this.Et=50}++this.Et}else{if(this.xe&&this.xe.opacity<1){this.xe.opacity+=.01;for(const t of this.ze)t.opacity+=.01,t.opacity>1&&(t.opacity=1);const t=[];for(let s=0;s<this.level.A.length;++s){const i=this.level.A[s];i.opacity-=.015,i.opacity<=0&&t.push(i)}for(let s=t.length-1;s>=0;--s)this.level.A.splice(t[s],1)}if(this.Te>0&&--this.Te,1===this.Te)return this._e(l._("level"),l.U("spawn")-100),l.Y(!0,"BeatMinigame2Dif"+this.Be),void l.Y(0,"MGP");if(this.xe&&s(this.ri.frame,this.xe.frame)&&0===this.Te&&(this.Te=200),this.ta(),this.sa()&&!this.Ye&&(this.Et=0,this.Ye=!0),60===this.Et&&this.Ye&&!this.xe&&(this.Re(),++this.Ze,this.Ve(),this.Ye=!1,this.Ze%5==0&&this.Ze<=30&&3!==this.Be&&this.Ne()),this.ke.length>0)for(let t=0;t<this.ke.length;++t)this.ke[t].frame.y>CANVAS_HEIGHT?this.ke.splice(t--,1):this.ke[t].frame.y+=2*SCALE}}sa(){return this.Je&&this.ri.frame.y<this.Je.frame.y||this.Qe&&this.ri.frame.y>this.Qe.frame.y||0===this.Oe.length}ta(){if(this.Et%20==0){for(let t=this.Oe.length-1;t>=0;--t)this.Oe[t].Gt&&this.Oe[t].Gt.active||(this.level.A.splice(this.level.A.findIndex((s=>s===this.Oe[t])),1),this.Oe.splice(t,1))}++this.Et}Re(){const s=Math.floor(Math.random()*this.Fe),i=o.g("minigames/2/MG2-"+s,!0);let h=GameObject_BASE_SIZE*SCALE;const e=i.split("\n");for(const t of e){const s=t.split(", ");parseInt(s[2])*SCALE>h&&(h=parseInt(s[2])*SCALE)}let n=0==Math.floor(2*Math.random());this.Ke=this.speed,7===s&&(this.Ke=1),this.Je=null,this.Qe=null;for(const s of e){const i=s.split(", ");let e=0;e=n?CANVAS_HEIGHT+parseInt(i[2])*SCALE:parseInt(i[2])*SCALE-h-GameObject_BASE_SIZE*SCALE;let S=0;if(S=n?-2*GameObject_BASE_SIZE*SCALE:CANVAS_HEIGHT+2*GameObject_BASE_SIZE*SCALE,"b"===i[0]){const s=new d(this.qe[0].frame.x+GameObject_BASE_SIZE*SCALE+parseInt(i[1])*SCALE,e,i[3]);s.Mt=!0,s.Ot=I._s(this.Ke,new t(s.frame.x,S,s.frame.width,s.frame.height),this.ri),this.level.A.splice(0,0,s),this.Oe.push(s),0!==parseInt(i[2])||n?parseInt(i[2])*SCALE===h&&n&&(this.Qe=s):this.Je=s}else{const s=new g(this.qe[0].frame.x+GameObject_BASE_SIZE*SCALE+parseInt(i[1])*SCALE,e,parseInt(i[3]));s.Ot=I._s(this.Ke,new t(s.frame.x,S,s.frame.width,s.frame.height),this.ri),this.level.A.splice(0,0,s),this.Oe.push(s),0!==parseInt(i[2])||n?parseInt(i[2])*SCALE===h&&n&&(this.Qe=s):this.Je=s}}}Ve(){switch(this.Ze){case 5:this.speed=1.25;break;case 13:this.speed=1.5;break;case 20:this.speed=1.75;break;case 30:this.speed=2;break;case 35:3!==this.Be&&this.We();break;case 40:this.speed=2.25;break;case 55:this.speed=2.5;break;case 70:this.speed=2.75;break;case 100:this.speed=3}}We(){let s=0;switch(this.Be){case 1:s=29,this.level.Kh=49;break;case 2:s=49,this.level.Kh=75}this.xe=new F(new t(.5*CANVAS_WIDTH-GameObject_BASE_SIZE/4*SCALE,.25*CANVAS_HEIGHT,GameObject_BASE_SIZE/2*SCALE,GameObject_BASE_SIZE/2*SCALE),s),this.level.Mi.push(this.xe),this.xe.opacity=0;for(let t=-1;t<=1;++t){const s=new d(this.xe.frame.x-GameObject_BASE_SIZE/4*SCALE+t*GameObject_BASE_SIZE*SCALE,this.xe.frame.y+.75*GameObject_BASE_SIZE*SCALE,"G");s.index={x:Math.ceil(s.frame.x/(GameObject_BASE_SIZE*SCALE)),y:Math.ceil(s.frame.y/(GameObject_BASE_SIZE*SCALE))},this.level.i[s.index.x][s.index.y]=s,s.alpha=0,this.ze.push(s)}}Ne(){for(let t=0;t<=this.qe.length;t+=this.qe.length-1){let s=0;s=0===t?-GameObject_BASE_SIZE*SCALE:GameObject_BASE_SIZE*SCALE;const i=new O(this.qe[t].frame.x+s,-GameObject_BASE_SIZE*SCALE);i.opacity=1,this.level.ne.push(i),this.ke.push(i)}l.K("BeatMinigame2Dif"+this.Be)||3===this.Be||l.Y(this.Ze,"MGP")}Xe(t){t>=30?(this.speed=2,this.Ze=30):t>=25?(this.speed=1.75,this.Ze=25):t>=20?(this.speed=1.75,this.Ze=20):t>=15?(this.speed=1.5,this.Ze=15):t>=10?(this.speed=1.25,this.Ze=10):t>=5&&(this.speed=1.25,this.Ze=5),this.ye||(this.label=new L("Survive as long as possible\nwith unlimited jumps!",25*SCALE+"px MunroSmall",{width:CANVAS_WIDTH,left:0,top:.4*CANVAS_HEIGHT}),this.label.at(1),this.label.$(),this.ye=!0)}}class Q extends v{constructor(s,i,h){super(s,i,h),this.ia=!0,this.step=0,this.Et=0,this.xe=null,this.ha=null,this.ea=null,this.aa=!1,this.na=0,this.ca=0,this.Sa=!1,this.oa=-1,this.ra=null,this.Aa=0,this.Ea=!1,this.ri.Os.p=!1,this.ri.xs(),this.xe=new F(new t(50.25*GameObject_BASE_SIZE*SCALE,23.25*GameObject_BASE_SIZE*SCALE,.5*GameObject_BASE_SIZE*SCALE,.5*GameObject_BASE_SIZE*SCALE),62),this.level.Mi.push(this.xe),this.ha={x:this.xe.frame.x,y:this.xe.frame.y},S(this.xe,this.level.qh),this.Sa=!0,this.step=1,this.ra=t=>{this.Ca()},window.addEventListener("keydown",this.ra)}update(){if(this.Mi&&this.Mi.zi(),this.la(),this.aa){for(const t of this.ea)t.opacity+=.02,t.frame.x+=t.fh,t.frame.y+=t.Ih;if(this.Et++,this.Et===this.ea[0].ph){this.aa=!1;for(const t of this.ea)this.level.ne.splice(this.level.ne.findIndex((s=>s===t)),1);this.oa=5,this.step=5,setTimeout((()=>{this.next()}),100)}}9===this.step&&this.ri.frame.x<=45.3*GameObject_BASE_SIZE*SCALE&&(this.ri.Xs(),this.ri.direction=1),9===this.step&&this.Mi.frame.x>=55.3*GameObject_BASE_SIZE*SCALE&&(this.Mi.Xs(),this.Mi.direction=0,this.step=10,setTimeout((()=>{this.next()}),800)),10==this.step&&this.ri.frame.y<17*GameObject_BASE_SIZE*SCALE&&(this.Aa=0,this.step=11),11==this.step&&(this.Aa+=.005,this.Aa>=1&&(this.Aa=1,this.step=12,this.Ea=!0))}la(){this.ri.qt&&1===this.step&&(this.step=2,setTimeout((()=>{this.next()}),700)),2===this.step&&this.ri.frame.x<=48.8*GameObject_BASE_SIZE*SCALE&&(this.ri.Xs(),this.ri.direction=1,this.step=3,setTimeout((()=>{this.next()}),400))}next(){switch(this.step){case 2:this.ri.left();break;case 3:this.step=4,this.ea=f.bt(this.ha.x,this.ha.y,9*GameObject_BASE_SIZE*SCALE),this.aa=!0;for(const t of this.ea)t.opacity=.03,t.dh({x:this.ha.x,y:this.ha.y},2),this.level.ne.push(t);break;case 5:this.step=6,this.Mi=new j(50*GameObject_BASE_SIZE*SCALE+(GameObject_BASE_SIZE*SCALE-this.ri.frame.width)/2,24*GameObject_BASE_SIZE*SCALE-this.ri.frame.height),this.Mi.Ki(7),this.Mi.direction=-1,this.Mi.ks=!0,this.level.Qh.push(this.Mi),setTimeout((()=>{this.next()}),1e3);break;case 6:this.step=7,this.ri.li=new _(new t(this.ri.frame.x+CAM_X_OFFSET-3*GameObject_BASE_SIZE*SCALE,this.ri.frame.y+CAM_Y_OFFSET-2*GameObject_BASE_SIZE*SCALE,80*SCALE,20*SCALE),"Mittens !",20*SCALE+"px Munro","gray");break;case 10:for(let s=45;s<=55;++s)this.level.i[s][24].Ot=I._s(1,new t(this.level.i[s][24].frame.x,0,GameObject_BASE_SIZE*SCALE,GameObject_BASE_SIZE*SCALE),this.ri),this.level.i[s][24].es(this.level.i[s][24].Ot[0]),this.level.A.push(this.level.i[s][24])}}Ca(){if(this.ri.li&&(this.ri.li.It(),!this.ri.li.St&&7===this.step))return this.step=8,void(this.Mi.li=new _(new t(this.Mi.frame.x+CAM_X_OFFSET+2.5*GameObject_BASE_SIZE*SCALE/2,this.Mi.frame.y+CAM_Y_OFFSET-2.5*GameObject_BASE_SIZE*SCALE,130*SCALE,20*SCALE),"Hurry! Fatso is not far!",20*SCALE+"px Munro","yellow"));this.Mi&&this.Mi.li&&(this.Mi.li.It(),this.Mi.li.St||8!==this.step||(this.step=9,this.ri.left(),this.Mi.right(),window.removeEventListener("keydown",this.ra)))}ft(){ctx.fillStyle="black",ctx.globalAlpha=this.Aa,ctx.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctx.globalAlpha=1}}class $ extends v{constructor(s,i,h){super(s,i,h),this.ye=!1,this.La=0,this._a=0,this.ua=null,this.ma=[],this.fa,this.Ia=[],this.pa=!0,this.da=0,this.wa=0,this.ba=!1,CAM_X_OFFSET=0,this.Sa=!0,this.ri.Os.p=!0;const e=CANVAS_WIDTH%(Chai_DEFAULT_MOVE_SPEED*SCALE);this.La=0===e?CANVAS_WIDTH:CANVAS_WIDTH+(Chai_DEFAULT_MOVE_SPEED*SCALE-e),this._a=(this.La-23*GameObject_BASE_SIZE*SCALE)/2;const n=this._a%(Chai_DEFAULT_MOVE_SPEED*SCALE);this._a-=n,this.ri.frame.x=6.3*GameObject_BASE_SIZE*SCALE+this._a,this.ri.frame.y=24*GameObject_BASE_SIZE*SCALE-this.ri.frame.height,this.ri.direction=1,this.ri.Lh(),this.Ze=1;const S=o.g("FatsoPlatform").split("\n");for(const t of S){const s=t.split(", ");if("b"===s[0]){const t=new d(parseInt(s[1])*SCALE+(this.La/2-3.5*GameObject_BASE_SIZE*SCALE),parseInt(s[2])*SCALE+19.5*GameObject_BASE_SIZE*SCALE,s[3]);this.ma.push(t),this.level.A.push(t),this.fa||20!==parseInt(s[2])||(this.fa=t)}else{const t=new g(parseInt(s[1])*SCALE+(this.La/2-3.5*GameObject_BASE_SIZE*SCALE),parseInt(s[2])*SCALE+19.5*GameObject_BASE_SIZE*SCALE,parseInt(s[3]));this.ma.push(t),this.level.A.push(t)}}this.ua={l:function(){let t;if(this.qi){let s=1===this.direction?this.Ni:this.Vi;t=s[Math.floor(this.Xi++/(this.Yi/s.length))%s.length]}else t=(1===this.direction?this.Ni:this.Vi)[this.ga?1:0];ctx.globalAlpha=this.opacity,ctx.drawImage(t,this.frame.x+CAM_X_OFFSET,this.frame.y+CAM_Y_OFFSET,this.frame.width,this.frame.height),ctx.globalAlpha=1},frame:new t(this.La/2-1.5*GameObject_BASE_SIZE*SCALE,17.5*GameObject_BASE_SIZE*SCALE,60*SCALE,80*SCALE),direction:-1,Ni:[],Vi:[],Yi:Math.ceil(9.6),Xi:0,qi:!1,ga:!1,opacity:1},this.Ma()}Xe(t){if(0===(t=l.U("BP"))&&(t=1),this.Ze=t,this.Ba("MGBPhase"+t),this.Ze%2==0){let t;t=this.ri.frame,this.ri.frame=this.ri.Xt.frame,this.ri.Xt.frame=t,this.ri.direction=1===this.ri.direction?-1:1,this.ri.Xt.direction=1===this.ri.Xt.direction?-1:1}}update(){const t=this.ri.frame.y-this.fa.frame.y;if(this.pa&&(t<0&&this.fa.frame.y>10*GameObject_BASE_SIZE*SCALE||t>0&&this.fa.frame.y<20.5*GameObject_BASE_SIZE*SCALE)){for(const s of this.ma)s.frame.y+=t/20;this.ua.frame.y+=t/20}if(this.ri.frame.y>this.ua.frame.y){if(this.da>=this.wa&&!this.ua.qi){const t=Math.floor(2*Math.random()),s=new g(this.ua.frame.x+GameObject_BASE_SIZE*SCALE,this.ua.frame.y+1.5*GameObject_BASE_SIZE*SCALE,t+3);let i;this.level.A.push(s),this.Ia.push(s),this.ua.direction=0===t?-1:1,this.ua.ga=!0,setTimeout((()=>{this.ua.ga=!1}),200),i=0===t?this.ri.frame.x<this.ri.Xt.frame.x?{x:this.ri.frame.x,y:this.ri.frame.y}:{x:this.ri.Xt.frame.x,y:this.ri.Xt.frame.y}:this.ri.frame.x>this.ri.Xt.frame.x?{x:this.ri.frame.x,y:this.ri.frame.y}:{x:this.ri.Xt.frame.x,y:this.ri.Xt.frame.y},s.kt=b.fs(s.frame,i,3),s.Ft=b.Is(s.frame,i,3),this.da=0}}else this.da=0;this.da++;for(let t=0;t<this.Ia.length;++t)(this.Ia[t].frame.x<-100||this.Ia[t].frame.x>40*GameObject_BASE_SIZE*SCALE)&&(this.level.A.splice(this.level.A.findIndex((s=>s===this.Ia[t])),1),this.Ia.splice(t--,1));this.ri.Os.p&&this.ri.frame.y+8*SCALE>this.ua.frame.y+1.5*GameObject_BASE_SIZE*SCALE&&this.ri.Xt.frame.y+.4*GameObject_BASE_SIZE*SCALE>this.ua.frame.y+GameObject_BASE_SIZE*SCALE&&s(this.ri.frame,this.ua.frame)&&s(this.ri.Xt.frame,this.ua.frame)&&(this.ri.Os.p=!1,this.ri.th(),this.ri.Xt.th(),this.ri.Fs=this.ri.frame.y-5*GameObject_BASE_SIZE*SCALE,this.ri.Xt.Fs=this.ri.Fs,1===this.ri.direction?(this.ri.right(),this.ri.Xt.left()):(this.ri.left(),this.ri.Xt.right()),this.ua.qi=!0,6===this.Ze&&(this.Oa=!0,document.getElementById("pause-btn").style.setProperty("display","none"),this.wa=1e9,this.Ga=30,this.Da=0,this.pa=!1,this.Ze=7,this.level.Kh=78)),!this.ri.Os.p&&(-1===this.ri.direction&&this.ri.frame.x<=this.La/2-4.2*GameObject_BASE_SIZE*SCALE||1===this.ri.direction&&this.ri.frame.x>=this.La/2+3.8*GameObject_BASE_SIZE*SCALE)&&(this.ri.xs(),this.ri.Xs(),this.ri.Xt.xs(),this.ri.Xt.Xs(),this.ri.direction=1===this.ri.direction?-1:1,this.ri.Xt.direction=1===this.ri.Xt.direction?-1:1),this.ri.frame.y>=22*GameObject_BASE_SIZE*SCALE&&!this.ri.Os.p&&this.Ze<7&&(this.ri.Os.p=!0,++this.Ze,this.Ze<=6&&(this.Ba("MGBPhase"+this.Ze),l.Y(this.Ze,"BP"),this.ua.qi=!1),this.da=0),this.Oa?(++this.Da,this.Da>=this.Ga&&(this.xa?this.Aa||(this.Aa=.001,this.Ta&&this.Ta.Aa>0&&this.Ta.ft()):(this.xa=!0,this.Ga=60,this.Da=0))):A(this.ri,this.level.qh),this.xa&&this.ua.opacity>=0&&(this.ua.opacity-=.008,this.ua.opacity<0&&(this.ua.opacity=0)),this.Aa&&(this.Aa+=.008,this.Aa>=1&&(this.Ga=30,this.Da=0,this.Aa=1,setTimeout((()=>{this.ka=!0}),1500)))}ft(){ctx.fillStyle="black",ctx.globalAlpha=this.Aa,ctx.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctx.globalAlpha=1}Ba(t){this.ba=!0,this.Ia=[],this.level=null,this.level=D.Se(t,1),this.level.ne.push(this.ua),this.level.Qh.push(this.ri,this.ri.Xt);for(let t=0;t<this.level.i.length;++t)for(let s=0;s<this.level.i[t].length;++s)this.level.i[t][s].S&&(this.level.i[t][s].Es(this._a),-1===this.level.A.findIndex((i=>i===this.level.i[t][s]))&&this.level.A.push(this.level.i[t][s]));for(const t of this.ma)-1===this.level.A.findIndex((s=>s===t))&&this.level.A.push(t);switch(this.Ze){case 1:this.wa=70;break;case 2:case 3:case 4:this.wa=200;break;case 5:this.wa=300;break;case 6:this.wa=1e8}this.Fa()}Fa(){let t=this.Ze;t>=4&&(++t,7===t&&(t=4));for(const s of this.ma)s.C&&(s.ds=t,s.ys(t))}Ma(){for(let t=0;t<2;++t)this.ua.Vi[t]=document.createElement("img"),this.ua.Vi[t].setAttribute("src","./assets/chais/fatso/FatsoLeft"+(t+1)+".png"),this.ua.Ni[t]=document.createElement("img"),this.ua.Ni[t].setAttribute("src","./assets/chais/fatso/FatsoRight"+(t+1)+".png")}}class tt{constructor(){this.St=!0,this.ja=.8,this.Ha=[[0,10],[10,0],[20,0],[30,0],[40,0],[50,10],[50,20],[50,30],[40,40],[30,40],[20,40],[10,40],[0,50],[0,60],[0,70],[0,80],[10,80],[20,80],[30,80],[40,80],[50,80]];for(let t=0;t<this.Ha.length;++t)this.Ha[t][0]*=this.ja,this.Ha[t][1]*=this.ja;this.va=[];for(let t=1;t<=6;++t)this.va[t-1]=document.createElement("img"),this.va[t-1].setAttribute("src","./assets/blocks/"+o.T(t)+".png");this.Za=0,this.ya=0,this.Ra=0,this.Va=2,this.Na=[],this.text=[];const t=252*SCALE,s=20*SCALE,i=(CANVAS_WIDTH-t-60*this.ja*SCALE-s)/2;if(this.text[0]=new L("Land of Chai",60*SCALE+"px MunroNarrow",{width:t,left:i,top:.07*CANVAS_HEIGHT}),this.Pa={x:i+t+s,y:.07*CANVAS_HEIGHT-5*SCALE},this.Wa=document.createElement("img"),this.Wa.setAttribute("src","./assets/img-other/AppIcon1024.png"),this.Xa=64*SCALE,It()){this.Ya=!0,this.text[1]=new L("This game is only playable via a desktop browser.\n\nAlternatively, you can download the iPhone app for free!",20*SCALE+"px Munro",{width:CANVAS_WIDTH,left:0,top:.4*CANVAS_HEIGHT});for(let t=0;t<this.text.length;++t)this.text[t].at(1),this.text[t].$();.33*CANVAS_HEIGHT>2*this.Xa&&(this.Xa*=2),this.Ua={x:(CANVAS_WIDTH-this.Xa)/2,y:.67*CANVAS_HEIGHT}}else{const t=260*SCALE,s=15*SCALE;this.Ua={x:(CANVAS_WIDTH-this.Xa-s-t)/2,y:.67*CANVAS_HEIGHT},this.text[1]=new L("Made by Thomas Patierno",25*SCALE+"px Munro",{width:260*SCALE,left:this.Ua.x+this.Xa+s,top:.67*CANVAS_HEIGHT+3*SCALE}),this.text[2]=new L("Powered by VanillaJS",20*SCALE+"px Munro",{width:170*SCALE,left:this.Ua.x+this.Xa+s,top:.67*CANVAS_HEIGHT+38*SCALE}),this.text[3]=new L("CLICK TO PLAY !",15*SCALE+"px MunroSmall",{width:CANVAS_WIDTH,left:0,top:.5*CANVAS_HEIGHT});for(let t=0;t<this.text.length;++t)this.text[t].at(1),this.text[t].$();this.text[3].$(),this.text[3].at(0),this.Ka=0}this.qa=[];for(let t=.5;t>.2;t-=.25){const s=new x(t);s.Ti(1,{width:10*CANVAS_WIDTH,height:2*CANVAS_HEIGHT},"c",25),this.qa.splice(0,0,s)}this.za=-1,CAM_X_OFFSET=-.5*CANVAS_WIDTH,CAM_Y_OFFSET=-.7*CANVAS_HEIGHT,window.requestAnimationFrame((()=>this.l()))}l(){if(this.arc||pt(),this.St){setTimeout((()=>{window.requestAnimationFrame((()=>this.l()))}),fpsctrl),ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);for(let t of this.qa)t.l();CAM_X_OFFSET+=2*this.za*SCALE,(CAM_X_OFFSET<-8.5*CANVAS_WIDTH||CAM_X_OFFSET>-.5*CANVAS_WIDTH)&&(this.za*=-1),++this.Ra,this.Ra===this.Va&&(this.Ra=0,this.Na[this.ya]={Ja:this.va[this.Za],frame:new t(this.Ha[this.ya][0]*SCALE,this.Ha[this.ya][1]*SCALE,10*this.ja*SCALE,10*this.ja*SCALE)},++this.ya,this.ya===this.Ha.length&&(this.ya=0,++this.Za>=6&&(this.Za=0),this.Ya||(this.Ka=1-this.Ka,this.text[3].at(this.Ka))));for(const t of this.Na)ctx.drawImage(t.Ja,this.Pa.x+t.frame.x,this.Pa.y+t.frame.y,t.frame.width,t.frame.height);ctx.drawImage(this.Wa,this.Ua.x,this.Ua.y,this.Xa,this.Xa),this.arc&&(this.Qa>CANVAS_WIDTH&&setTimeout((()=>{this.$a()}),35),this.Qa*=1.1,ctx.beginPath(),ctx.arc(this.arc.x,this.arc.y,this.Qa,0,2*Math.PI,!1),ctx.fillStyle="white",ctx.fill())}}tn(t,s){this.Ya?window.location.href="https://apps.apple.com/us/app/land-of-chai-2/id988246727":(Lt.sn(),this.arc||(this.arc={x:t,y:s},this.Qa=5),canvas.style.setProperty("cursor","default"))}$a(){if(!game){for(let t=0;t<this.text.length;++t)this.text[t].st();this.St=!1,game=new it,this.Qa=5,ctx.save(),window.requestAnimationFrame((()=>this.hn()))}}hn(){ctx.fillStyle="white",ctx.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctx.restore(),this.Qa*=1.2,ctx.beginPath(),ctx.arc(this.arc.x,this.arc.y,this.Qa,0,2*Math.PI,!1),ctx.save(),ctx.clip(),game.en(!0),this.Qa>CANVAS_WIDTH?(ctx.restore(),game.an=!0,window.requestAnimationFrame((()=>game.en())),this.finished=!0):setTimeout((()=>{window.requestAnimationFrame((()=>this.hn()))}),fpsctrl)}}class st{constructor(){const t=l.U("deaths");let s=0;for(let t=1;t<=6;++t)for(let i=1;i<=10;++i)s+=l.U("C"+t+"-"+i);this.text=[],this.text[0]=new L("You Win!",60*SCALE+"px Munro",{width:CANVAS_WIDTH,left:0,top:.15*CANVAS_HEIGHT}),this.text[1]=new L(t+" Deaths",30*SCALE+"px MunroSmall",{width:CANVAS_WIDTH,left:0,top:.45*CANVAS_HEIGHT}),this.text[2]=new L(s+" Chais Rescued",30*SCALE+"px MunroSmall",{width:CANVAS_WIDTH,left:0,top:.45*CANVAS_HEIGHT+35*SCALE});for(let t=0;t<this.text.length;++t)this.text[t].at(1);this.text[0].$();this.nn=document.createElement("div"),this.nn.classList.add("btn-div"),this.nn.style.setProperty("position","absolute"),this.nn.style.setProperty("width","168px"),this.nn.style.setProperty("height","50px"),this.nn.style.setProperty("left",CANVAS_WIDTH/2-84+"px"),this.nn.style.setProperty("top",.75*CANVAS_HEIGHT+"px"),this.nn.style.setProperty("font-size","200%"),this.nn.style.setProperty("padding","2px 10px 2px 13px"),this.nn.onclick=()=>{this.$a=!0},this.nn.innerHTML="Play Again",this.qa=[];for(let t=.5;t>.2;t-=.25){const s=new x(t);s.Ti(1,{width:10*CANVAS_WIDTH,height:2*CANVAS_HEIGHT},"c",25),this.qa.splice(0,0,s)}this.za=-1,CAM_X_OFFSET=-.5*CANVAS_WIDTH,CAM_Y_OFFSET=-.7*CANVAS_HEIGHT,this.Et=0,window.requestAnimationFrame((()=>this.l()))}l(){if(ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),this.$a){for(let t=0;t<this.text.length;++t)this.text[t].st();return this.nn.remove(),l.q(),game=new it,game.an=!0,void game.en()}for(let t of this.qa)t.l();switch(CAM_X_OFFSET+=2*this.za*SCALE,(CAM_X_OFFSET<-8.5*CANVAS_WIDTH||CAM_X_OFFSET>-.5*CANVAS_WIDTH)&&(this.za*=-1),++this.Et,this.Et){case 120:this.text[1].$();break;case 180:this.text[2].$();break;case 420:canvasContainer.appendChild(this.nn)}setTimeout((()=>{window.requestAnimationFrame((()=>this.l()))}),fpsctrl)}}class it{constructor(){this.transition=null,this.level=null,this.cn=[],this.ri=null,this.Sn=0,this.paused=!1,this.on=l.K("assist"),this.rn=!1,this.Xh=null,this.Ce=0,this.An=null,this.En=null,this.Cn=null,this.ln=l.U("deaths"),this.Ln=!1,this._n=null,this.un=new c,this.Uh=l._("level"),this.mn=l.U("spawn"),this.Uh&&""!==this.Uh||(this.Uh="Tutorial",this.mn=0),this.fn="Minigame1"===this.Uh||"Minigame2"===this.Uh||"BossFight"===this.Uh,0===this.mn&&(this.mn=1);for(let t=.5;t>.2;t-=.25){const s=new x(t);this.cn.splice(0,0,s)}this.Se()}Se(){"Tutorial"===this.Uh&&(this.Cn=new T(this.Uh)),this.level=D.Se(this.Uh,this.mn,this.Xh,l.U("checkpoint")),this.ri=new H(this.level.Jh.Ee.x,this.level.Jh.Ee.y,this.un),this.ri.direction=this.level.Jh.oe?1:-1,this.level.Qh.push(this.ri),this.ri.Ri=-6*this.level.$h;for(const t of this.level.Qh)t.ji=this.level.qh,t.h=this.level.h;const s=l.K("Beat"+this.Uh+"Dif"+l.U(this.Uh+"Dif"))?0:l.U("MGP"),i=!!this.Ta&&this.Ta.ye;this.Ta&&this.Ta.label&&this.Ta.label.st(),this.level.ie>0?this.Ta=v.ue(this.level.ie,this.ri,this.level,this.Ce):this.Ta=null,this.Ce=0,this.fn&&(this.Ta.ye=i,this.Ta.Xe(s),this.level=this.Ta.level);const h=()=>{!titleScreen||titleScreen.finished?(titleScreen=null,this.level.he?document.getElementById("pause-btn").style.setProperty("display","none"):document.getElementById("pause-btn").style.setProperty("display","block")):setTimeout((()=>h()),16)};h();for(const t of this.cn)t.Ti(this.level.Ai,this.level.qh,o.g(this.Uh));this._n&&this._n.Lt();const e=this.Ln?""+this.ln:this.level.name;e.length>0&&(this._n=new _(new t(0,10*SCALE,0,0),e,20*SCALE+"px MunroNarrow","darkgray",!0),this._n._t(CANVAS_WIDTH-this._n.frame.width-10*SCALE),this._n.lt.ht(-1*SCALE),this._n.lt.et(-1),this._n.It(),this._n.opacity=2,this.Ln=!1)}In(){if(this.Sn=0,this.transition=null,this.An=!1,this.En=!1,this.Cn)for(const t of this.Cn.ki)t.Lt();this.Cn=null,this.Se()}pn(t,s,i,h){this.fn=!1,this.Uh=t,this.mn=s,"Minigame1"!==this.Uh&&"Minigame2"!==this.Uh&&"BossFight"!==this.Uh?this.dn():(this.fn=!0,"BossFight"===this.Uh&&l.Y("BossFight","level")),this.Xh=null,this.An=!0,h?setTimeout((()=>{this.level.Ai=o.H(t,this.level.Ai),this.transition=new C(o.T(this.level.Ai),{x:this.ri.frame.x+CAM_X_OFFSET,y:this.ri.frame.y+CAM_Y_OFFSET})}),1e3*i):(this.level.Ai=o.H(t,this.level.Ai),this.In())}en(i=!1){if(this.an&&(pt(),setTimeout((()=>{window.requestAnimationFrame((()=>this.en()))}),fpsctrl)),!this.paused||i){if(!this.ri.Zi){++this.Sn,this.ri.Ch(),this.Ta&&(this.Ta.update(),0!==this.Ta.Le&&(this.pn(this.Ta.le,this.Ta.Le,0,!0),this.Ta.Le=0),this.Ta.ba&&(this.level=this.Ta.level,this.Ta.ba=!1));const i=[];for(const t of this.level.Qh)if(t.Wt||t.ks||t.Ms&&t.Ps){const s=t.nh(),e=t.Sh();for(let n=s;n<s+5&&n<this.level.i.length;n++)for(let s=e;s<e+5&&s<this.level.i[n].length;s++)-1===i.indexOf(this.level.i[n][s])&&i.push(this.level.i[n][s]),t.Nt&&t.Ms&&(h({x:n-1,y:s},t.Nt.index)||h({x:n+1,y:s},t.Nt.index))&&y.Rh(t,this.level.i[n][s],n,this.Sn)}for(const h of this.level.A)h.Rs&&s(new t(this.ri.frame.x-2*h.frame.width,this.ri.frame.y,4*h.frame.width,this.ri.frame.height),h.frame)&&-1===i.indexOf(h)&&i.push(h);for(const t of this.level.Qh)if(t.Ms)if(t.bh||t.xh(this.ri)){for(const s of i)s.Rs&&s.Ns(t);t.Th()}else t.zi(),!t.Mh&&(t.frame.x<this.ri.frame.x&&-1===t.direction||t.frame.x>this.ri.frame.x&&1===t.direction)&&(t.direction=-1===t.direction?1:-1);for(const t of this.level.A){if(!t.Bt)for(let s=0;s<t.Ot.length;s++){const i=t.Ot[s];switch(m.Ls(i.Cs)){case 1:i.os=this.ri;break;case 2:break;case 3:i.os=this.level.i[i.Cs.x][i.Cs.y]}t.Bt=!0}t.Ss(this.ri)}for(const t of this.level.A)t.Vt(this.ri),-1===i.indexOf(t)&&i.push(t);this.wn(i),this.Ta&&this.Ta.bn&&document.getElementById("pause-btn").style.setProperty("display","none");for(let t=0;t<this.level.Qh.length;t++)this.level.Qh[t].frame.y>this.level.qh.height+50*SCALE&&!this.level.Qh[t].Vs&&(++this.ln,l.Y(this.ln,"deaths"),this.Ln=!0,this.Ta&&this.Ta.label&&this.Ta.label.st(),this.In())}this.transition&&this.transition.finished&&!this.En&&(this.En=!0,setTimeout((()=>this.In()),300)),this.Ta&&this.Ta.ia&&this.Ta.Ea&&(this.Uh="BossFight",l.Y(this.Uh,"level"),this.mn=1,this.fn=!0,this.In()),this.Ta&&this.Ta.Sa||S(this.ri,this.level.qh),this.gn(!0),this.an&&this.Ta&&this.Ta.ka&&(ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),winScreen=new st,this.an=!1)}}gn(t){if(ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),this.Ta&&this.Ta.oa>0)return--this.Ta.oa,ctx.fillStyle="white",void ctx.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);for(const t of this.cn)t.l();if(E(this.level),this.level.ce(),this.transition&&this.transition.l(),t){if(this.Cn)for(const t of this.Cn.ki)t.l();this._n&&(this._n.l(),this._n.opacity-=.01,this._n.opacity<0&&(this._n.Lt(),this._n=null))}this.Ta&&this.Ta.Aa>0&&this.Ta.ft()}wn(t){t=r.Z(t);for(const s of this.level.Qh){s.Ms&&!s.Oh&&(s.Ys=!1,s.Ws=!1);let i=!1;for(const h of t)h.C?i=h.Zt(s,i):h.Rs&&!this.on?h.Zt(s,!1)&&(!this.ri.Zi&&this.ri.Ui&&(++this.ln,l.Y(this.ln,"deaths"),this.Ln=!0,setTimeout((()=>this.In()),800)),s.ah(),this.ri.Zi=!0):h.Us&&(h.Zt(this.ri)?(h.qs!==this.ri.direction&&(h.qs=this.ri.direction,l.Y(this.ri.direction,"checkpoint-dir")),2!==h.animation&&h.wt(),this.Xh&&this.Xh!==h&&this.Xh.ti(),this.Xh=h):h.active&&1!==h.animation&&h.dt())}for(const t of this.level.Mi)if(s(this.ri.frame,t.frame)){t.collect();for(const t of this.level.se)t.Zt(this.ri,!1)}if(this.Cn)for(const t of this.Cn.ki)s(t.Ct,this.ri.frame)?t.St||(t.St=!0,t.lt.$(),t.dt()):t.St&&t.wt();if(!this.ri.Zi){for(const t of this.level.h)if(t==this.ri.Hi&&"decor"!==t.P&&"notreal"!==t.P){let t=this.ri.$s.length+1;this.ri.Vs&&--t;for(const s of this.ri.$s)this.ri.Vs&&s.Bs&&(s.Vs=!0),s.Vs&&--t;0!==t||this.An||(this.Ce=this.ri.$s.length,this.pn(this.ri.Hi.P,this.ri.Hi.hi,.3,!0))}for(const t of this.level.keys)t.finished||s(this.ri.frame,t.frame)&&this.ri.Nt&&(t.frame.x=this.ri.frame.x-6*SCALE,t.frame.y=this.ri.frame.y-25*SCALE,t.Ci=t.frame.y,t.ri=this.ri,this.ri.li=t.Li(this.ri),this.ri.li.It(),this.ri.Ri=-120,t.oi=120,this.ri.Xs())}}dn(){l.Y(this.Uh,"level"),l.Y(this.mn,"spawn"),l.Y(0,"checkpoint"),"RescueCutscene"===this.Uh&&(l.Y("BossFight","level"),l.Y(!0,"M62"));for(let t=0;t<3;t++)l.Y(!1,"chai"+t)}Mn(){if(this.paused)return!1;if(!this.ri.Zi&&0===this.ri.Ri&&!this.ri.Vs&&!this.rn){if(this.Cn||this._n){if(this.gn(!1),this.Cn)for(const t of this.Cn.ki)t.lt.st();this._n&&this._n.lt.st(),this.Ta&&this.Ta.label&&this.Ta.label.st()}return!0}return!1}unpause(){if(this.paused=!1,this.Cn)for(const t of this.Cn.ki)t.lt.$();this._n&&this._n.opacity>0&&this._n.lt.$(),this.Ta&&this.Ta.label&&this.Ta.label.$()}}function pt(){if(!fps_calibrationFinished){const t=Date.now();if(null==fps_prevTime)return fps_prevTime=t,void(fpsctrl_force?(fpsctrl=l.U("fpsctrl"),fps_calibrationFinished=!0,console.log(fpsctrl)):fps_samples.push(0));const s=t-fps_prevTime;if(s>100)return fps_samples[fps_currentSample]=0,fps_framesInSample=0,void(fps_prevTime=t);if(fps_samples[fps_currentSample]+=s,fps_framesInSample+=2,fps_prevTime=t,fps_samples[fps_currentSample]>=500){if(fps_samples[fps_currentSample]={Xn:fpsctrl,Yn:fps_framesInSample},fps_currentSampleAmt=0,++fps_currentSample,fps_samples.push(0),fps_framesInSample>60?++fpsctrl:--fpsctrl,fpsctrl<0)return fpsctrl=0,fps_calibrationFinished=!0,void console.log(fpsctrl);if(fps_framesInSample=0,console.log(fps_samples),fps_currentSample>=10&&fpsctrl===fps_samples[fps_currentSample-2].Xn){const t=fps_samples[fps_currentSample-1],s=fps_samples[fps_currentSample-2],i=Math.abs(t.Yn-60)<Math.abs(s.Yn-60);fpsctrl=i?t.Xn:s.Xn,(i?t.Yn:s.Yn)>=70&&--fpsctrl,fps_calibrationFinished=!0,console.log(fpsctrl)}}}}function nt(){document.getElementById("inventory").classList.remove("hidden"),document.getElementById("inventory").style.setProperty("left",CANVAS_WIDTH-INV_WIDTH+"px"),At(),""!==game.level.ee.text?document.getElementById("btn-exit-level").innerHTML=game.level.ee.text:document.getElementById("btn-exit-level").innerHTML="",lt.Gn()}function St(){document.getElementById("inventory").classList.add("hidden"),lt.xn(rebindingNow)}function at(){lt.kn(0),lt.xn(rebindingNow);for(let t=1;t<=6;++t){document.getElementById("keys-carrying-A"+t).innerHTML=l.U("A"+t+"KT");let s=0;for(let i=1;i<=5;++i)l.K("A"+t+"K"+i)&&++s;document.getElementById("keys-total-A"+t).innerHTML="("+s+"/5 found)",0===s?document.getElementById("key-row-A"+t).classList.add("not-found"):document.getElementById("key-row-A"+t).classList.remove("not-found")}}function At(){lt.kn(1),lt.xn(rebindingNow);const t={B:"#8E5900",Y:"#DAAC00",W:"#FEFFFF",P:"#AB3761"};let s=o.M("./assets/chais/mittens/MittensOutline.txt").split("\n"),i=0;for(let h=1;h<=62;++h){let e=s[h-1].split(", ");l.K("M"+h)?(document.getElementById("m"+e[0]+"-"+e[1]).style.backgroundColor=t[e[2]],++i):document.getElementById("m"+e[0]+"-"+e[1]).style.backgroundColor="inherit"}document.getElementById("mittens-count").innerHTML=i+"/62"}function Et(){lt.kn(2),lt.xn(rebindingNow);for(let t=1;t<=6;++t){let s=0;for(let i=1;i<=10;++i)s+=l.U("C"+t+"-"+i);document.getElementById("chais-A"+t).innerHTML=s+"/30",0===s?document.getElementById("chai-row-A"+t).classList.add("not-found"):document.getElementById("chai-row-A"+t).classList.remove("not-found")}}function ct(){""!==game.level.ee.text&&(mt(),game.pn(game.level.ee.level,game.level.ee.hi,0,!1))}function ot(){lt.xn(0)}function rt(){lt.xn(1)}function Ct(){lt.xn(2)}fpsctrl_force=0!==l.U("fpsctrl"),fpsctrl=15,fps_samples=[],fps_currentSample=0,fps_calibrationFinished=!1,fps_framesInSample=0,fps_prevTime=null,rebindEvtListener=null,rebindingNow=-1,INV_WIDTH=240;class lt{static kn(t){const s=["panel-keys","panel-mittens","panel-chais"];for(let i=0;i<s.length;++i)i===t?document.getElementById(s[i]).classList.remove("hidden"):document.getElementById(s[i]).classList.add("hidden");this.xn(rebindingNow)}static Gn(){this.yn("ctrl-left",game.un.L),this.yn("ctrl-right",game.un.u),this.yn("ctrl-jump",game.un.m)}static xn(t){if(t<0)return;const s=["ctrl-left","ctrl-right","ctrl-jump"],i=["keyLeft","keyRight","keyUp"];if(rebindingNow===t)return 0===t?this.yn("ctrl-left",game.un.L):1===t?this.yn("ctrl-right",game.un.u):2===t&&this.yn("ctrl-jump",game.un.m),rebindingNow=-1,void window.removeEventListener("keydown",rebindEvtListener);-1!==rebindingNow&&(0===rebindingNow?this.yn("ctrl-left",game.un.L):1===rebindingNow?this.yn("ctrl-right",game.un.u):2===rebindingNow&&this.yn("ctrl-jump",game.un.m),window.removeEventListener("keydown",rebindEvtListener)),rebindingNow=t,document.getElementById(s[t]).innerHTML="...",rebindEvtListener=h=>{0===t?game.un.L=h.code:1===t?game.un.u=h.code:2===t&&(game.un.m=h.code),this.yn(s[t],h.code),l.Y(h.code,i[t]),rebindingNow=-1,window.removeEventListener("keydown",rebindEvtListener)},window.addEventListener("keydown",rebindEvtListener)}static yn(t,s){4===s.length&&s.includes("Key")?document.getElementById(t).innerHTML=s[3]:6===s.length&&s.includes("Digit")?document.getElementById(t).innerHTML=s[5]:s.includes("Arrow")?document.getElementById(t).innerHTML=s.slice(5):document.getElementById(t).innerHTML=s}}global_songs=[],global_songNow=-1,global_songVolume=.5;class Lt{static sn(){if(!(global_songs.length>0)){for(let t=1;t<=8;++t)global_songs.push(document.getElementById("song"+t)),global_songs[t-1].addEventListener("ended",(()=>{Lt.Pn()}));Lt.Pn(),Lt.Wn(global_songVolume)}}static Pn(){let t=Math.floor(8*Math.random())+1;for(;global_songNow===t;)t=Math.floor(8*Math.random())+1;global_songNow=t,global_songs[t-1].play()}static Wn(t){global_songVolume=t;for(let s=0;s<8;++s)global_songs[s].volume=t}static pause(){-1!==global_songNow&&global_songs[global_songNow-1].pause()}static unpause(){-1!==global_songNow&&global_songs[global_songNow-1].play()}}function _t(){canvasContainer=document.getElementById("canvasContainer"),canvas=document.getElementById("gameCanvas"),e(),ctx=canvas.getContext("2d"),titleScreen=new tt,canvas.style.setProperty("cursor","pointer"),window.addEventListener("focus",(()=>{Lt.unpause()})),window.addEventListener("blur",(()=>{Lt.pause(),game&&(game.un.left=!1,game.un.right=!1,game.un.I=!1,titleScreen&&!titleScreen.finished||ft())}))}function ft(){game.Mn()&&(document.getElementById("pause-btn").style.setProperty("display","none"),Lt.Wn(.2),game.paused=!0,ctx.globalAlpha=.7,ctx.fillStyle="black",ctx.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctx.globalAlpha=1,game.pauseLabel1?(game.pauseLabel1.$(),game.pauseLabel2.$()):(game.pauseLabel1=new L("PAUSED",75*SCALE+"px MunroSmall",{width:CANVAS_WIDTH-INV_WIDTH,left:0,top:.25*CANVAS_HEIGHT}),game.pauseLabel1.at(1),game.pauseLabel1.$(),game.pauseLabel2=new L("click anywhere to resume",25*SCALE+"px Munro",{width:CANVAS_WIDTH-INV_WIDTH,left:0,top:.55*CANVAS_HEIGHT}),game.pauseLabel2.at(1),game.pauseLabel2.$()),canvas.style.setProperty("cursor","pointer"),nt())}function ut(t){titleScreen?titleScreen.tn(t.clientX,t.clientY):mt()}function mt(){game&&game.paused&&(game.unpause(),document.getElementById("pause-btn").style.setProperty("display","block"),Lt.Wn(.5),game.pauseLabel1.st(),game.pauseLabel2.st(),canvas.style.setProperty("cursor","default"),St())}function It(){let t=!1;var s;return s=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(s)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(s.substr(0,4)))&&(t=!0),t}canvasContainer=null,canvas=null,ctx=null,titleScreen=null,game=null,winScreen=null;